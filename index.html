<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מכון רב הופמן - ניהול מרכזי</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f1f5f9; }
        .tab-active { background-color: #1e293b; border-right: 4px solid #3b82f6; color: white; }
    </style>
</head>
<body class="flex min-h-screen">

    <aside class="w-64 bg-slate-800 text-slate-300 flex-shrink-0 flex flex-col">
        <div class="p-6 text-white text-2xl font-bold border-b border-slate-700">מכון רב הופמן</div>
        <nav class="flex-1 mt-4 space-y-1">
            <button onclick="switchTab('tasks')" class="nav-btn w-full text-right py-3 px-6 hover:bg-slate-700 transition"><i class="fas fa-clipboard-list ml-2"></i> משימות ולו"ז</button>
            <button onclick="switchTab('books')" class="nav-btn w-full text-right py-3 px-6 hover:bg-slate-700 transition"><i class="fas fa-book-open ml-2"></i> מערך הספרים</button>
            <button onclick="switchTab('donors')" class="nav-btn w-full text-right py-3 px-6 hover:bg-slate-700 transition"><i class="fas fa-heart ml-2"></i> גיוס כספים</button>
            <button onclick="switchTab('logistics')" class="nav-btn w-full text-right py-3 px-6 hover:bg-slate-700 transition"><i class="fas fa-shipping-fast ml-2"></i> הפצה וחו"ל</button>
            <button onclick="switchTab('expenses')" class="nav-btn w-full text-right py-3 px-6 hover:bg-slate-700 transition"><i class="fas fa-shekel-sign ml-2"></i> חובות וספקים</button>
        </nav>
        <div class="p-4 text-xs bg-slate-900 italic">מנהל מערכת: ביינוש קרליבך</div>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="bg-white p-4 shadow-sm flex justify-between items-center">
            <h1 id="page-title" class="text-xl font-bold">טוען...</h1>
            <button onclick="fetchData()" class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700"><i class="fas fa-sync"></i> רענן</button>
        </header>

        <section id="main-content" class="p-6 overflow-y-auto">
            <div id="loader" class="text-center py-20 font-bold text-slate-500">מעבד נתונים מהמכון...</div>
            <div id="content-grid" class="hidden"></div>
        </section>
    </main>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyd_BSYKaO2H9RIAkzPYPemJxU8M2aYemI6UGqNfzOOsfKBF0r3b2LmvOuKBib7bqLY/exec?action=getData";
        let dataStore = {};

        async function fetchData() {
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('content-grid').classList.add('hidden');
            try {
                const res = await fetch(API_URL);
                dataStore = await res.json();
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('content-grid').classList.remove('hidden');
                switchTab('tasks');
            } catch (e) {
                document.getElementById('loader').innerHTML = "שגיאה בחיבור לנתונים. וודא שהפריסה בגוגל תקינה.";
            }
        }

        function switchTab(tab) {
            const container = document.getElementById('content-grid');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('tab-active'));
            // כאן אפשר להוסיף לוגיקת צביעה לכפתור שנבחר
            
            if (tab === 'tasks') renderTasks(container);
            if (tab === 'books') renderBooks(container);
            if (tab === 'donors') renderDonors(container);
            if (tab === 'expenses') renderExpenses(container);
        }

        function renderTasks(el) {
            document.getElementById('page-title').innerText = "משימות לפי חודש ודחיפות";
            let html = `<div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full text-right">
                    <thead class="bg-slate-100 italic"><tr><th class="p-3">משימה</th><th class="p-3">דחיפות</th><th class="p-3">מנהל</th></tr></thead>
                    <tbody>`;
            (dataStore.tasks || []).forEach(t => {
                const urgencyColor = t.דחיפות === 'גבוהה' ? 'text-red-600 font-bold' : 'text-slate-600';
                html += `<tr class="border-b"><td class="p-3">${t.משימה}</td><td class="p-3 ${urgencyColor}">${t.דחיפות}</td><td class="p-3">${t.מנהל}</td></tr>`;
            });
            el.innerHTML = html + `</tbody></table></div>`;
        }

        function renderBooks(el) {
            document.getElementById('page-title').innerText = "מערך הספרים והדפסה";
            let html = `<div class="grid grid-cols-1 md:grid-cols-3 gap-4">`;
            (dataStore.books || []).forEach(b => {
                html += `<div class="bg-white p-5 rounded-lg shadow-md border-r-4 border-blue-500">
                    <h3 class="font-bold text-lg">${b.שם}</h3>
                    <p class="text-sm text-slate-500">סטטוס: ${b.סטטוס}</p>
                    <div class="mt-3 text-xs flex justify-between"><span>גויס: ${b.גויס} ₪</span><span>יעד: ${b.יעד} ₪</span></div>
                    <div class="w-full bg-slate-200 h-2 mt-1 rounded-full"><div class="bg-green-500 h-2 rounded-full" style="width:${(b.גויס/b.יעד*100)}%"></div></div>
                </div>`;
            });
            el.innerHTML = html + `</div>`;
        }

        function renderExpenses(el) {
            document.getElementById('page-title').innerText = "חובות לספקים ועלויות שוטפות";
            let html = `<div class="space-y-4">`;
            (dataStore.expenses || []).forEach(e => {
                html += `<div class="bg-white p-4 rounded shadow flex justify-between items-center">
                    <div><span class="font-bold">${e.ספק}</span> <span class="text-xs text-slate-400 mr-2">${e.קטגוריה}</span></div>
                    <div class="text-red-600 font-bold">${e.סכום} ₪</div>
                </div>`;
            });
            el.innerHTML = html + `</div>`;
        }

        window.onload = fetchData;
    </script>
</body>
</html>