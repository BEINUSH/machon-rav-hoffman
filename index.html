<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>××¢×¨×›×ª × ×™×”×•×œ - ××›×•×Ÿ ×¨×‘ ×”×•×¤××Ÿ (××©×•×“×¨×’)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap');
    body { font-family: 'Assistant', sans-serif; }
    .card { background:#fff; border-radius: 1rem; box-shadow: 0 8px 20px rgba(2,6,23,.06); }
    .chip { border-radius: 999px; padding: 2px 10px; font-size: 11px; font-weight: 800; }
    .btn { border-radius: 0.75rem; font-weight: 800; transition: .15s; }
    .btn:active { transform: scale(.98); }
    .fade-in { animation: fadeIn .22s ease-out; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(8px);} to {opacity:1; transform:none;} }

    /* Clickable cards look like buttons */
    .clickable { cursor: pointer; transition: transform .12s, box-shadow .12s; }
    .clickable:hover { transform: translateY(-2px); box-shadow: 0 14px 28px rgba(2,6,23,.10); }

    /* Drawer */
    .drawer-overlay { background: rgba(2,6,23,.55); backdrop-filter: blur(6px); }
    .drawer { width: min(520px, 92vw); }
    .drawer-enter { animation: drawerIn .18s ease-out; }
    @keyframes drawerIn { from { transform: translateX(-14px); opacity:.2; } to { transform:none; opacity:1; } }

    /* Simple focus */
    .field { border: 2px solid #e2e8f0; border-radius: .75rem; padding: .75rem .9rem; outline: none; width:100%; }
    .field:focus { border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59,130,246,.12); }
  </style>
</head>

<body class="h-screen overflow-hidden bg-slate-50 text-slate-900">
  <div class="flex h-full">

    <!-- Sidebar -->
    <aside class="w-72 bg-slate-900 text-slate-200 flex flex-col shadow-2xl z-20 overflow-y-auto shrink-0">
      <div class="p-6 border-b border-slate-800">
        <h1 class="text-white text-xl font-extrabold tracking-tight">××›×•×Ÿ ×¨×‘ ×”×•×¤××Ÿ</h1>
        <p class="text-[10px] text-slate-400 mt-1 uppercase tracking-widest">× ×™×”×•×œ ×•×”×•×¦××” ×œ××•×¨</p>
      </div>

      <nav class="flex-1 p-4 space-y-1 text-sm">
        <div class="text-[10px] font-extrabold text-slate-500 px-4 mb-2 uppercase">× ×™×”×•×œ ×©×•×˜×£</div>
        <button class="nav-item w-full sidebar-link btn px-4 py-3 text-right hover:bg-slate-800" data-tab="tasks">
          <i class="fas fa-list-ul ml-3"></i> ××©×™××•×ª ×•×œ×•"×–
        </button>
        <button class="nav-item w-full sidebar-link btn px-4 py-3 text-right hover:bg-slate-800" data-tab="staff">
          <i class="fas fa-users-cog ml-3"></i> ×¢×•×‘×“×™ ×”××›×•×Ÿ
        </button>

        <div class="text-[10px] font-extrabold text-slate-500 px-4 mt-6 mb-2 uppercase">××¢×¨×š ×”×¡×¤×¨×™×</div>
        <button class="nav-item w-full sidebar-link btn px-4 py-3 text-right hover:bg-slate-800" data-tab="books-he">
          <i class="fas fa-book ml-3"></i> ×¡×¤×¨×™× - ×¢×‘×¨×™×ª
        </button>
        <button class="nav-item w-full sidebar-link btn px-4 py-3 text-right hover:bg-slate-800" data-tab="books-en">
          <i class="fas fa-language ml-3"></i> ××“×•×¨ ×× ×’×œ×™×ª
        </button>

        <div class="text-[10px] font-extrabold text-slate-500 px-4 mt-6 mb-2 uppercase">×›×¡×¤×™× ×•×œ×•×’×™×¡×˜×™×§×”</div>
        <button class="nav-item w-full sidebar-link btn px-4 py-3 text-right hover:bg-slate-800" data-tab="donors">
          <i class="fas fa-hand-holding-heart ml-3"></i> ×’×™×•×¡ ×›×¡×¤×™×
        </button>
        <button class="nav-item w-full sidebar-link btn px-4 py-3 text-right hover:bg-slate-800" data-tab="logistics">
          <i class="fas fa-shipping-fast ml-3"></i> ×”×¤×¦×” ×•×—×•"×œ
        </button>
        <button class="nav-item w-full sidebar-link btn px-4 py-3 text-right hover:bg-slate-800" data-tab="expenses">
          <i class="fas fa-file-invoice-dollar ml-3"></i> ×—×•×‘×•×ª ×œ×¡×¤×§×™×
        </button>
      </nav>

      <div class="p-4 bg-slate-950 border-t border-slate-800">
        <p class="text-[10px] text-slate-500 mb-1 font-extrabold">×‘×¢×œ×•×ª ×”×¢××•×ª×”:</p>
        <p class="text-xs font-extrabold text-white">×××™×¨ ×©××—×” ×©×˜×™×™×Ÿ</p>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 flex flex-col min-w-0">
      <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shadow-sm">
        <div class="flex items-center gap-3 min-w-0">
          <h2 id="current-title" class="text-lg font-extrabold text-slate-900 truncate">××©×™××•×ª ×•×œ×•"×– ×‘×™×¦×•×¢</h2>
          <span id="current-sub" class="hidden md:inline text-xs text-slate-400 font-bold truncate"></span>
        </div>

        <div class="flex items-center gap-3">
          <div class="hidden md:flex items-center bg-slate-100 rounded-xl px-3 py-2">
            <i class="fas fa-magnifying-glass text-slate-400 ml-2"></i>
            <input id="search" class="bg-transparent outline-none text-sm w-64" placeholder="×—×™×¤×•×© ×‘×˜××‘ ×”× ×•×›×—×™..." />
          </div>

          <button id="btn-add" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 shadow-md flex items-center">
            <i class="fas fa-plus ml-2"></i><span id="btn-add-text">×”×•×¡×£ ×—×“×©</span>
          </button>

          <button id="btn-refresh" class="btn bg-slate-100 hover:bg-slate-200 px-3 py-2 text-slate-600">
            <i class="fas fa-rotate"></i>
          </button>
        </div>
      </header>

      <div class="p-6 overflow-y-auto h-full">
        <div id="content" class="space-y-6 fade-in"></div>
      </div>
    </main>
  </div>

  <!-- Drawer -->
  <div id="drawer-wrap" class="hidden fixed inset-0 z-50">
    <div class="absolute inset-0 drawer-overlay" data-close="1"></div>

    <div class="absolute left-0 top-0 h-full bg-white shadow-2xl drawer drawer-enter flex flex-col">
      <div class="p-5 border-b bg-slate-50 flex items-start justify-between gap-4">
        <div class="min-w-0">
          <div id="drawer-title" class="text-lg font-extrabold text-slate-900 truncate">×¤×¨×˜×™×</div>
          <div id="drawer-meta" class="text-xs text-slate-500 font-bold mt-1"></div>
        </div>
        <button class="btn px-3 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700" data-close="1">
          <i class="fas fa-xmark"></i>
        </button>
      </div>

      <div id="drawer-body" class="p-5 overflow-y-auto flex-1 space-y-4"></div>

      <div id="drawer-actions" class="p-5 border-t bg-white flex gap-2 justify-end"></div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal-wrap" class="hidden fixed inset-0 z-50">
    <div class="absolute inset-0 drawer-overlay" data-modal-close="1"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
        <div class="p-5 border-b bg-slate-50 flex items-center justify-between">
          <div id="modal-title" class="text-lg font-extrabold">×”×•×¡×¤×”</div>
          <button class="btn px-3 py-2 bg-slate-200 hover:bg-slate-300" data-modal-close="1">
            <i class="fas fa-xmark"></i>
          </button>
        </div>
        <div id="modal-body" class="p-5 overflow-y-auto flex-1 space-y-3"></div>
        <div class="p-5 border-t bg-white flex justify-end gap-2">
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" data-modal-close="1">×‘×™×˜×•×œ</button>
          <button id="modal-save" class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white">
            <i class="fas fa-check ml-2"></i> ×©××•×¨
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast-root" class="fixed top-6 left-1/2 -translate-x-1/2 z-[60] space-y-2"></div>

  <script>
    // =========================
    // Store + Helpers
    // =========================
    const store = {
      tasks: [
        { ××©×™××”: "×”×›× ×ª ×—×©×‘×•× ×•×ª ×œ×ª×•×¨××™× ×—×•×“×© ×–×”", ×× ×”×œ: "××©×” ×›×”×Ÿ", ×“×—×™×¤×•×ª: "×’×‘×•×”×”", ×˜×•×•×—: "×—×•×“×©×™" },
        { ××©×™××”: "×©×œ×™×—×ª ×¢×“×›×•×Ÿ ×œ×× ×•×™×™ ×”× ×™×•×–×œ×˜×¨", ×× ×”×œ: "×™×•×¡×™ ×œ×•×™", ×“×—×™×¤×•×ª: "×’×‘×•×”×”", ×˜×•×•×—: "×—×•×“×©×™" },
        { ××©×™××”: "×‘×™×§×•×¨ ××¦×œ ××•×´×œ ×‘× ×™ ×‘×¨×§", ×× ×”×œ: "×“×•×“ ×’×•×œ×“", ×“×—×™×¤×•×ª: "×’×‘×•×”×”", ×˜×•×•×—: "×—×•×“×©×™" },
        { ××©×™××”: "×ª×™××•× ×¤×’×™×©×ª ×ª×›× ×•×Ÿ ×©× ×” ×”×‘××”", ×× ×”×œ: "××©×” ×›×”×Ÿ", ×“×—×™×¤×•×ª: "×¨×’×™×œ×”", ×˜×•×•×—: "××¨×•×š" },
        { ××©×™××”: "×¢×“×›×•×Ÿ ××ª×¨ ×”××™× ×˜×¨× ×˜", ×× ×”×œ: "×™×•×¡×™ ×œ×•×™", ×“×—×™×¤×•×ª: "×¨×’×™×œ×”", ×˜×•×•×—: "××¨×•×š" }
      ],
      staff: [
        { ×©×: "××©×” ×›×”×Ÿ", ×ª×¤×§×™×“: "×× ×”×œ ×›×œ×œ×™", ×˜×œ×¤×•×Ÿ: "050-1234567", ××™××™×™×œ: "moshe@hoffman.org" },
        { ×©×: "×™×•×¡×™ ×œ×•×™", ×ª×¤×§×™×“: "×× ×”×œ ×©×™×•×•×§", ×˜×œ×¤×•×Ÿ: "052-7654321", ××™××™×™×œ: "yossi@hoffman.org" },
        { ×©×: "×“×•×“ ×’×•×œ×“", ×ª×¤×§×™×“: "×œ×•×’×™×¡×˜×™×§×”", ×˜×œ×¤×•×Ÿ: "054-9876543", ××™××™×™×œ: "david@hoffman.org" },
        { ×©×: "×©×¨×” ×’×¨×™×Ÿ", ×ª×¤×§×™×“: "×¢×•×¨×›×ª ×¨××©×™×ª", ×˜×œ×¤×•×Ÿ: "050-5555555", ××™××™×™×œ: "sara@hoffman.org" }
      ],
      books: {
        he: [
          { name: '×™×¡×•×“×•×ª ×”×—×™× ×•×š', target: 50000, raised: 32500, donors: 12 },
          { name: '××•×“×¢×•×ª', target: 40000, raised: 32800, donors: 18 },
          { name: '×©×™×“×•×›×™×', target: 35000, raised: 15750, donors: 8 },
          { name: '×¢×œ ×”×¤×—×“', target: 30000, raised: 8400, donors: 5 },
          { name: '×”××—×•× ×š', target: 25000, raised: 22500, donors: 15 },
          { name: '×›××™×', target: 45000, raised: 24750, donors: 11 }
        ],
        en: [
          { name: 'Awareness (××•×“×¢×•×ª)', target: 60000, raised: 42000, donors: 22 },
          { name: 'Shidduchim (×©×™×“×•×›×™×)', target: 50000, raised: 20000, donors: 10 },
          { name: 'Foundations of Education', target: 55000, raised: 30250, donors: 14 },
          { name: 'Like Water (×›××™×)', target: 40000, raised: 14000, donors: 7 }
        ]
      },
      donors: [
        { ×©×: "××‘×¨×”× ×›×”×Ÿ", ×¤×¨×•×™×§×˜: "×™×¡×•×“×•×ª ×”×—×™× ×•×š", ××ª× ×”: 5000, ×ª××¨×™×š: "2025-02-01" },
        { ×©×: "×©×¨×” ×œ×•×™", ×¤×¨×•×™×§×˜: "×©×™×“×•×›×™×", ××ª× ×”: 3500, ×ª××¨×™×š: "2025-02-05" },
        { ×©×: "×™×¢×§×‘ ×’×¨×™× ×‘×¨×’", ×¤×¨×•×™×§×˜: "××•×“×¢×•×ª", ××ª× ×”: 7200, ×ª××¨×™×š: "2025-01-10" },
        { ×©×: "×¨×—×œ ×©×•×•×¨×¥", ×¤×¨×•×™×§×˜: "×›××™×", ××ª× ×”: 2800, ×ª××¨×™×š: "2025-02-05" }
      ],
      expenses: [
        { ×¡×¤×§: "×“×¤×•×¡ ××¨×›×–", ×¡×›×•×: 12500, ×¡×˜×˜×•×¡: "×××ª×™×Ÿ" },
        { ×¡×¤×§: "××©×¨×“ - ×©×›×™×¨×•×ª ×—×•×“×©×™×ª", ×¡×›×•×: 1000, ×¡×˜×˜×•×¡: "×××ª×™×Ÿ" },
        { ×¡×¤×§: "×’××´×— ×”×¡×¤×¨×™×", ×¡×›×•×: 8300, ×¡×˜×˜×•×¡: "×××ª×™×Ÿ" },
        { ×¡×¤×§: "×©×œ×™×—×•×™×•×ª ×‘×™× ×´×œ", ×¡×›×•×: 4200, ×¡×˜×˜×•×¡: "×××ª×™×Ÿ" }
      ],
      logistics: {
        israel: [
          { city: "×™×¨×•×©×œ×™×", books: 350, status: "×¤×¢×™×œ" },
          { city: "×‘× ×™ ×‘×¨×§", books: 280, status: "×¤×¢×™×œ" },
          { city: "×¦×¤×ª", books: 120, status: "×¤×¢×™×œ" },
          { city: "×‘××¨ ×©×‘×¢", books: 95, status: "×‘×”××ª× ×”" }
        ],
        international: [
          { country: "××¨×”×´×‘", books: 500, status: "×‘×©×œ×™×—×”" },
          { country: "×× ×’×œ×™×”", books: 180, status: "×¤×¢×™×œ" },
          { country: "×¦×¨×¤×ª", books: 95, status: "×¤×¢×™×œ" },
          { country: "××•×¡×˜×¨×œ×™×”", books: 65, status: "×‘×ª×›× ×•×Ÿ" }
        ]
      }
    };

    const state = {
      tab: "tasks",
      search: "",
      selected: null, // { type, index, group? }
      modalMode: null, // 'add' | 'edit'
      modalPayload: null
    };

    const titles = {
      tasks: "××©×™××•×ª ×•×œ×•×´×– ×‘×™×¦×•×¢",
      staff: "×¢×•×‘×“×™ ×”××›×•×Ÿ ×•×¦×•×•×ª ×”× ×™×”×•×œ",
      "books-he": "××¢×¨×š ×”×¡×¤×¨×™× - ×¢×‘×¨×™×ª",
      "books-en": "International Division - English",
      donors: "×’×™×•×¡ ×›×¡×¤×™× ×•×ª×•×¨××™× ××§×˜×•××œ×™×™×",
      logistics: "×”×¤×¦×” ×‘××¨×¥ ×•×‘×—×•×´×œ",
      expenses: "×—×•×‘×•×ª ×œ×¡×¤×§×™× ×•×¢×œ×•×™×•×ª ×©×•×˜×¤×•×ª"
    };

    const addLabels = {
      tasks: "×”×•×¡×£ ××©×™××”",
      staff: "×”×•×¡×£ ×¢×•×‘×“",
      "books-he": "×”×•×¡×£ ×¡×¤×¨ (×¢×‘×¨×™×ª)",
      "books-en": "×”×•×¡×£ ×¡×¤×¨ (×× ×’×œ×™×ª)",
      donors: "×”×•×¡×£ ×ª×¨×•××”",
      logistics: "×”×•×¡×£ ×™×¢×“ ×”×¤×¦×”",
      expenses: "×”×•×¡×£ ×”×•×¦××”"
    };

    const $ = (id) => document.getElementById(id);

    function nfmt(num) { return (num ?? 0).toLocaleString(); }

    function toast(msg, tone="ok") {
      const wrap = $("toast-root");
      const el = document.createElement("div");
      const colors = {
        ok: "bg-emerald-600",
        warn: "bg-amber-600",
        bad: "bg-rose-600",
        info: "bg-slate-800"
      };
      el.className = `${colors[tone] || colors.ok} text-white px-5 py-3 rounded-xl shadow-2xl font-extrabold text-sm flex items-center gap-2 fade-in`;
      el.innerHTML = `<i class="fas fa-circle-check"></i><span>${msg}</span>`;
      wrap.appendChild(el);
      setTimeout(() => {
        el.style.opacity = "0";
        el.style.transition = "opacity .25s";
        setTimeout(() => el.remove(), 250);
      }, 2300);
    }

    function pct(raised, target) {
      if (!target || target <= 0) return 0;
      const p = Math.round((raised / target) * 100);
      return Math.max(0, Math.min(100, p));
    }

    function chipUrgency(u) {
      if (u === "×’×‘×•×”×”") return `<span class="chip bg-rose-100 text-rose-700">×“×—×•×£</span>`;
      return `<span class="chip bg-slate-100 text-slate-600">×¨×’×™×œ</span>`;
    }

    function chipStatus(s) {
      if (s === "×¤×¢×™×œ") return `<span class="chip bg-emerald-100 text-emerald-700">×¤×¢×™×œ</span>`;
      if (s === "×‘×©×œ×™×—×”") return `<span class="chip bg-blue-100 text-blue-700">×‘×©×œ×™×—×”</span>`;
      if (s === "×‘×”××ª× ×”") return `<span class="chip bg-amber-100 text-amber-700">×‘×”××ª× ×”</span>`;
      return `<span class="chip bg-slate-100 text-slate-700">${s}</span>`;
    }

    // =========================
    // Router + Render
    // =========================
    function setActiveNav(tab) {
      document.querySelectorAll(".nav-item").forEach(b => {
        b.classList.remove("bg-blue-600", "text-white");
        b.classList.add("text-slate-200");
        if (b.dataset.tab === tab) {
          b.classList.add("bg-blue-600", "text-white");
          b.classList.remove("text-slate-200");
        }
      });
    }

    function render() {
      $("current-title").innerText = titles[state.tab] || "××›×•×Ÿ ×¨×‘ ×”×•×¤××Ÿ";
      $("btn-add-text").innerText = addLabels[state.tab] || "×”×•×¡×£ ×—×“×©";
      $("current-sub").innerText = state.search ? `××¡×•× ×Ÿ ×œ×¤×™: "${state.search}"` : "";

      setActiveNav(state.tab);

      const content = $("content");
      content.classList.remove("fade-in");
      void content.offsetWidth;
      content.classList.add("fade-in");

      if (state.tab === "tasks") renderTasks(content);
      else if (state.tab === "staff") renderStaff(content);
      else if (state.tab === "donors") renderDonors(content);
      else if (state.tab === "expenses") renderExpenses(content);
      else if (state.tab === "logistics") renderLogistics(content);
      else if (state.tab === "books-he") renderBooks(content, "he");
      else if (state.tab === "books-en") renderBooks(content, "en");
    }

    function filtered(list, mapper) {
      const q = state.search.trim();
      if (!q) return list;
      const low = q.toLowerCase();
      return list.filter(item => (mapper(item) || "").toLowerCase().includes(low));
    }

    // =========================
    // Cards
    // =========================
    function renderTasks(el) {
      const tasks = filtered(store.tasks, t => `${t.××©×™××”} ${t.×× ×”×œ} ${t.×“×—×™×¤×•×ª} ${t.×˜×•×•×—}`);
      const high = tasks.filter(t => t.×“×—×™×¤×•×ª === "×’×‘×•×”×”");
      const regular = tasks.filter(t => t.×“×—×™×¤×•×ª !== "×’×‘×•×”×”");

      el.innerHTML = `
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="card p-5 border-r-8 border-rose-500">
            <div class="flex items-center gap-2 mb-4">
              <div class="font-extrabold text-rose-600 text-lg"><i class="fas fa-fire ml-2"></i>×“×—×•×£ ×œ×‘×™×¦×•×¢</div>
              <span class="mr-auto chip bg-rose-100 text-rose-700">${high.length}</span>
            </div>
            ${high.length ? high.map(t => {
              const idx = store.tasks.indexOf(t);
              return `
              <div class="clickable p-4 bg-rose-50 rounded-xl border border-rose-100 mb-3"
                   role="button" tabindex="0"
                   data-open="task" data-index="${idx}">
                <div class="flex items-start justify-between gap-3">
                  <div class="font-extrabold">${t.××©×™××”}</div>
                  ${chipUrgency(t.×“×—×™×¤×•×ª)}
                </div>
                <div class="text-[11px] text-rose-500 font-bold mt-2">××—×¨××™: ${t.×× ×”×œ} â€¢ ×˜×•×•×—: ${t.×˜×•×•×—}</div>
                <div class="text-[11px] text-slate-500 mt-2">×œ×—×¥ ×œ×¤×¨×˜×™× / ×¢×¨×™×›×” / ×¡×™×•×</div>
              </div>`;
            }).join("") : `<div class="text-center text-slate-400 font-bold py-10">××™×Ÿ ××©×™××•×ª ×“×—×•×¤×•×ª ğŸ‰</div>`}
          </div>

          <div class="card p-5 border-r-8 border-slate-300">
            <div class="flex items-center gap-2 mb-4">
              <div class="font-extrabold text-slate-700 text-lg">×›×œ×œ ×”××©×™××•×ª</div>
              <span class="mr-auto chip bg-slate-100 text-slate-700">${tasks.length}</span>
            </div>

            <div class="space-y-2">
              ${tasks.length ? tasks.map(t => {
                const idx = store.tasks.indexOf(t);
                return `
                <div class="clickable p-4 rounded-xl border border-slate-200 hover:bg-slate-50"
                     role="button" tabindex="0"
                     data-open="task" data-index="${idx}">
                  <div class="flex items-start justify-between gap-3">
                    <div class="font-bold text-slate-900">${t.××©×™××”}</div>
                    ${chipUrgency(t.×“×—×™×¤×•×ª)}
                  </div>
                  <div class="text-[11px] text-slate-500 font-bold mt-2">××—×¨××™: ${t.×× ×”×œ} â€¢ ×˜×•×•×—: ${t.×˜×•×•×—}</div>
                </div>`;
              }).join("") : `<div class="text-center text-slate-400 font-bold py-10">××™×Ÿ ××©×™××•×ª</div>`}
            </div>
          </div>
        </div>
      `;
    }

    function renderStaff(el) {
      const staff = filtered(store.staff, s => `${s.×©×} ${s.×ª×¤×§×™×“} ${s.×˜×œ×¤×•×Ÿ} ${s.××™××™×™×œ}`);
      el.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
          ${staff.map(s => {
            const idx = store.staff.indexOf(s);
            return `
            <div class="card clickable p-5 border-b-4 border-blue-500"
                 role="button" tabindex="0"
                 data-open="staff" data-index="${idx}">
              <div class="flex items-center gap-3 mb-3">
                <div class="bg-blue-100 text-blue-700 p-3 rounded-full"><i class="fas fa-user-tie"></i></div>
                <div class="min-w-0">
                  <div class="font-extrabold text-lg truncate">${s.×©×}</div>
                  <div class="text-[11px] text-slate-500 font-extrabold uppercase">${s.×ª×¤×§×™×“}</div>
                </div>
                <span class="mr-auto chip bg-slate-100 text-slate-700">×œ×—×¥ ×œ×¤×¨×˜×™×</span>
              </div>
              <div class="text-sm text-slate-700 space-y-1">
                <div><i class="fas fa-phone ml-2 text-blue-400"></i>${s.×˜×œ×¤×•×Ÿ}</div>
                <div class="truncate"><i class="fas fa-envelope ml-2 text-blue-400"></i>${s.××™××™×™×œ}</div>
              </div>
            </div>`;
          }).join("")}
        </div>
      `;
    }

    function renderBooks(el, lang) {
      const books = filtered(store.books[lang], b => `${b.name} ${b.target} ${b.raised} ${b.donors}`);
      el.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
          ${books.map(b => {
            const idx = store.books[lang].indexOf(b);
            const p = pct(b.raised, b.target);
            return `
            <div class="card clickable p-5 border-t-4 border-blue-600"
                 role="button" tabindex="0"
                 data-open="book" data-lang="${lang}" data-index="${idx}">
              <div class="flex items-start justify-between gap-3">
                <div class="font-extrabold text-lg">${b.name}</div>
                <span class="chip bg-emerald-100 text-emerald-700">${p}%</span>
              </div>

              <div class="text-[10px] text-slate-400 mt-2 font-extrabold uppercase">××¦×‘ ×’×™×•×¡ ×›×¡×¤×™×</div>

              <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden mt-3">
                <div class="h-full bg-emerald-600" style="width:${p}%"></div>
              </div>

              <div class="flex justify-between items-center mt-4">
                <div class="text-sm font-extrabold text-emerald-700">â‚ª${nfmt(b.raised)}</div>
                <div class="text-xs text-slate-400 font-bold">×™×¢×“: â‚ª${nfmt(b.target)}</div>
              </div>

              <div class="text-xs text-slate-600 font-bold mt-3">
                <i class="fas fa-users ml-1"></i> ${b.donors} ×ª×•×¨××™×
                <span class="text-slate-400 mr-2">â€¢ ×œ×—×¥ ×œ×¤×¨×˜×™×/×¢×¨×™×›×”</span>
              </div>
            </div>`;
          }).join("")}
        </div>
      `;
    }

    function renderDonors(el) {
      const donors = filtered(store.donors, d => `${d.×©×} ${d.×¤×¨×•×™×§×˜} ${d.××ª× ×”} ${d.×ª××¨×™×š}`);
      const total = donors.reduce((s, d) => s + (Number(d.××ª× ×”) || 0), 0);
      const avg = donors.length ? Math.round(total / donors.length) : 0;

      el.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <div class="card p-5 bg-emerald-600 text-white">
            <div class="text-xs font-extrabold opacity-90 uppercase">×¡×”×´×› ×’×™×•×¡ (××¡×•× ×Ÿ)</div>
            <div class="text-4xl font-extrabold mt-2">â‚ª${nfmt(total)}</div>
          </div>
          <div class="card p-5 bg-blue-600 text-white">
            <div class="text-xs font-extrabold opacity-90 uppercase">×ª×•×¨××™× (××¡×•× ×Ÿ)</div>
            <div class="text-4xl font-extrabold mt-2">${donors.length}</div>
          </div>
          <div class="card p-5 bg-purple-600 text-white">
            <div class="text-xs font-extrabold opacity-90 uppercase">×××•×¦×¢ ×ª×¨×•××”</div>
            <div class="text-4xl font-extrabold mt-2">â‚ª${nfmt(avg)}</div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
          ${donors.map(d => {
            const idx = store.donors.indexOf(d);
            return `
            <div class="card clickable p-5 border-t-4 border-pink-500"
                 role="button" tabindex="0"
                 data-open="donor" data-index="${idx}">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="font-extrabold text-lg">${d.×©×}</div>
                  <div class="text-xs text-slate-500 font-bold mt-1">${d.×¤×¨×•×™×§×˜}</div>
                </div>
                <div class="text-right">
                  <div class="font-extrabold text-emerald-700">â‚ª${nfmt(d.××ª× ×”)}</div>
                  <div class="text-[11px] text-slate-400 font-bold">${d.×ª××¨×™×š}</div>
                </div>
              </div>
              <div class="text-[11px] text-slate-400 mt-3 font-bold">×œ×—×¥ ×œ×¤×¨×˜×™× / ×¢×¨×™×›×” / ××—×™×§×”</div>
            </div>`;
          }).join("")}
        </div>
      `;
    }

    function renderExpenses(el) {
      const expenses = filtered(store.expenses, e => `${e.×¡×¤×§} ${e.×¡×›×•×} ${e.×¡×˜×˜×•×¡}`);
      const total = expenses.reduce((s, e) => s + (Number(e.×¡×›×•×) || 0), 0);

      el.innerHTML = `
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6 text-center">
          <div class="card p-4 border-b-4 border-blue-500">
            <p class="text-[10px] text-slate-400 font-extrabold uppercase">××©×¨×“</p>
            <h2 class="text-2xl font-extrabold mt-1">â‚ª1,000</h2>
          </div>
          <div class="card p-4 border-b-4 border-slate-800">
            <p class="text-[10px] text-slate-400 font-extrabold uppercase">×—× ×™×”</p>
            <h2 class="text-2xl font-extrabold mt-1">â‚ª450</h2>
          </div>
          <div class="card p-4 border-b-4 border-slate-800">
            <p class="text-[10px] text-slate-400 font-extrabold uppercase">×¨×›×‘</p>
            <h2 class="text-2xl font-extrabold mt-1">â‚ª1,500</h2>
          </div>
          <div class="card p-4 border-b-4 border-emerald-500">
            <p class="text-[10px] text-slate-400 font-extrabold uppercase">×“×™×’×™×˜×œ</p>
            <h2 class="text-2xl font-extrabold mt-1">$100</h2>
          </div>
          <div class="card p-4 border-b-4 border-rose-500">
            <p class="text-[10px] text-rose-500 font-extrabold uppercase">×—×•×‘×•×ª (××¡×•× ×Ÿ)</p>
            <h2 class="text-2xl font-extrabold mt-1 text-rose-600">â‚ª${nfmt(total)}</h2>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
          ${expenses.map(e => {
            const idx = store.expenses.indexOf(e);
            return `
            <div class="card clickable p-5 border-t-4 border-rose-500"
                 role="button" tabindex="0"
                 data-open="expense" data-index="${idx}">
              <div class="flex items-start justify-between gap-3">
                <div class="font-extrabold">${e.×¡×¤×§}</div>
                <span class="chip bg-rose-100 text-rose-700">â‚ª${nfmt(e.×¡×›×•×)}</span>
              </div>
              <div class="text-[11px] text-slate-500 font-bold mt-2">×¡×˜×˜×•×¡: ${e.×¡×˜×˜×•×¡}</div>
              <div class="text-[11px] text-slate-400 font-bold mt-3">×œ×—×¥ ×œ×©×œ× / ×œ×¢×¨×•×š / ×œ××—×•×§</div>
            </div>`;
          }).join("")}
        </div>
      `;
    }

    function renderLogistics(el) {
      const israel = filtered(store.logistics.israel, x => `${x.city} ${x.books} ${x.status}`);
      const international = filtered(store.logistics.international, x => `${x.country} ${x.books} ${x.status}`);

      el.innerHTML = `
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
          <div class="card p-5 border-r-4 border-blue-500">
            <div class="flex items-center gap-2 mb-4">
              <div class="font-extrabold text-blue-700 text-lg"><i class="fas fa-location-dot ml-2"></i>×”×¤×¦×” ×‘××¨×¥</div>
              <span class="mr-auto chip bg-blue-100 text-blue-700">${israel.length}</span>
            </div>

            <div class="space-y-3">
              ${israel.map(loc => {
                const idx = store.logistics.israel.indexOf(loc);
                return `
                <div class="clickable p-4 rounded-xl bg-blue-50 border border-blue-100 flex justify-between items-center"
                     role="button" tabindex="0"
                     data-open="log-israel" data-index="${idx}">
                  <div>
                    <div class="font-extrabold">${loc.city}</div>
                    <div class="text-xs mt-2">${chipStatus(loc.status)}</div>
                  </div>
                  <div class="chip bg-blue-700 text-white">${loc.books} ×¡×¤×¨×™×</div>
                </div>`;
              }).join("")}
            </div>
          </div>

          <div class="card p-5 border-r-4 border-purple-500">
            <div class="flex items-center gap-2 mb-4">
              <div class="font-extrabold text-purple-700 text-lg"><i class="fas fa-globe ml-2"></i>×”×¤×¦×” ×‘×—×•×´×œ</div>
              <span class="mr-auto chip bg-purple-100 text-purple-700">${international.length}</span>
            </div>

            <div class="space-y-3">
              ${international.map(loc => {
                const idx = store.logistics.international.indexOf(loc);
                return `
                <div class="clickable p-4 rounded-xl bg-purple-50 border border-purple-100 flex justify-between items-center"
                     role="button" tabindex="0"
                     data-open="log-int" data-index="${idx}">
                  <div>
                    <div class="font-extrabold">${loc.country}</div>
                    <div class="text-xs mt-2">${chipStatus(loc.status)}</div>
                  </div>
                  <div class="chip bg-purple-700 text-white">${loc.books} ×¡×¤×¨×™×</div>
                </div>`;
              }).join("")}
            </div>
          </div>
        </div>
      `;
    }

    // =========================
    // Drawer (click a "cube")
    // =========================
    function openDrawer(payload) {
      state.selected = payload;

      const wrap = $("drawer-wrap");
      wrap.classList.remove("hidden");

      const { type } = payload;

      if (type === "task") drawerTask(payload.index);
      else if (type === "staff") drawerStaff(payload.index);
      else if (type === "book") drawerBook(payload.lang, payload.index);
      else if (type === "donor") drawerDonor(payload.index);
      else if (type === "expense") drawerExpense(payload.index);
      else if (type === "log-israel") drawerLogIsrael(payload.index);
      else if (type === "log-int") drawerLogInt(payload.index);
    }

    function closeDrawer() {
      $("drawer-wrap").classList.add("hidden");
      $("drawer-body").innerHTML = "";
      $("drawer-actions").innerHTML = "";
      state.selected = null;
    }

    function drawerSet(title, meta, bodyHtml, actionsHtml) {
      $("drawer-title").innerText = title;
      $("drawer-meta").innerHTML = meta || "";
      $("drawer-body").innerHTML = bodyHtml || "";
      $("drawer-actions").innerHTML = actionsHtml || "";
    }

    // ===== Drawer builders =====
    function drawerTask(idx) {
      const t = store.tasks[idx];
      if (!t) return closeDrawer();

      drawerSet(
        "××©×™××”",
        `<span class="chip bg-slate-100 text-slate-700">××—×¨××™: ${t.×× ×”×œ}</span> ${chipUrgency(t.×“×—×™×¤×•×ª)} <span class="chip bg-slate-100 text-slate-700">×˜×•×•×—: ${t.×˜×•×•×—}</span>`,
        `
          <div class="card p-4 border border-slate-200">
            <div class="text-xs text-slate-400 font-extrabold uppercase">×ª×™××•×¨</div>
            <div class="text-lg font-extrabold mt-1">${t.××©×™××”}</div>
          </div>

          <div class="space-y-2">
            <label class="text-xs font-extrabold text-slate-600">×¢×¨×™×›×ª ×ª×™××•×¨</label>
            <input id="ed-task-name" class="field" value="${escapeHtml(t.××©×™××”)}" />

            <label class="text-xs font-extrabold text-slate-600">××—×¨××™</label>
            <select id="ed-task-manager" class="field">
              ${store.staff.map(s => `<option ${s.×©× === t.×× ×”×œ ? "selected" : ""}>${s.×©×}</option>`).join("")}
            </select>

            <label class="text-xs font-extrabold text-slate-600">×“×—×™×¤×•×ª</label>
            <select id="ed-task-urg" class="field">
              <option value="×¨×’×™×œ×”" ${t.×“×—×™×¤×•×ª === "×¨×’×™×œ×”" ? "selected" : ""}>×¨×’×™×œ×”</option>
              <option value="×’×‘×•×”×”" ${t.×“×—×™×¤×•×ª === "×’×‘×•×”×”" ? "selected" : ""}>×’×‘×•×”×” ğŸ”¥</option>
            </select>

            <label class="text-xs font-extrabold text-slate-600">×˜×•×•×—</label>
            <select id="ed-task-range" class="field">
              <option value="×—×•×“×©×™" ${t.×˜×•×•×— === "×—×•×“×©×™" ? "selected" : ""}>×—×•×“×©×™</option>
              <option value="××¨×•×š" ${t.×˜×•×•×— === "××¨×•×š" ? "selected" : ""}>×˜×•×•×— ××¨×•×š</option>
            </select>
          </div>
        `,
        `
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" onclick="closeDrawer()">×¡×’×•×¨</button>
          <button class="btn px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white" onclick="deleteTask(${idx})"><i class="fas fa-trash ml-2"></i>××—×§</button>
          <button class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white" onclick="saveTask(${idx})"><i class="fas fa-floppy-disk ml-2"></i>×©××•×¨</button>
          <button class="btn px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white" onclick="completeTask(${idx})"><i class="fas fa-check ml-2"></i>×¡×™×™×</button>
        `
      );
    }

    function drawerStaff(idx) {
      const s = store.staff[idx];
      if (!s) return closeDrawer();

      drawerSet(
        "×›×¨×˜×™×¡ ×¢×•×‘×“",
        `<span class="chip bg-blue-100 text-blue-700">${s.×ª×¤×§×™×“}</span>`,
        `
          <div class="grid gap-3">
            <div>
              <label class="text-xs font-extrabold text-slate-600">×©×</label>
              <input id="ed-staff-name" class="field" value="${escapeHtml(s.×©×)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×ª×¤×§×™×“</label>
              <input id="ed-staff-role" class="field" value="${escapeHtml(s.×ª×¤×§×™×“)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×˜×œ×¤×•×Ÿ</label>
              <input id="ed-staff-phone" class="field" value="${escapeHtml(s.×˜×œ×¤×•×Ÿ)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">××™××™×™×œ</label>
              <input id="ed-staff-email" class="field" value="${escapeHtml(s.××™××™×™×œ)}" />
            </div>
          </div>
        `,
        `
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" onclick="closeDrawer()">×¡×’×•×¨</button>
          <button class="btn px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white" onclick="deleteStaff(${idx})"><i class="fas fa-trash ml-2"></i>××—×§</button>
          <button class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white" onclick="saveStaff(${idx})"><i class="fas fa-floppy-disk ml-2"></i>×©××•×¨</button>
        `
      );
    }

    function drawerBook(lang, idx) {
      const b = store.books[lang][idx];
      if (!b) return closeDrawer();
      const p = pct(b.raised, b.target);

      drawerSet(
        "×¤×¨×•×™×§×˜ ×¡×¤×¨",
        `<span class="chip bg-emerald-100 text-emerald-700">${p}% ×’×™×•×¡</span> <span class="chip bg-slate-100 text-slate-700">${lang === "he" ? "×¢×‘×¨×™×ª" : "×× ×’×œ×™×ª"}</span>`,
        `
          <div class="card p-4 border border-slate-200">
            <div class="text-xs text-slate-400 font-extrabold uppercase">×©× ×”×¡×¤×¨</div>
            <div class="text-xl font-extrabold mt-1">${b.name}</div>
            <div class="mt-3 w-full bg-slate-100 h-3 rounded-full overflow-hidden">
              <div class="h-full bg-emerald-600" style="width:${p}%"></div>
            </div>
            <div class="flex justify-between mt-3 text-sm font-extrabold">
              <span class="text-emerald-700">â‚ª${nfmt(b.raised)}</span>
              <span class="text-slate-400">×™×¢×“: â‚ª${nfmt(b.target)}</span>
            </div>
          </div>

          <div class="grid gap-3">
            <div>
              <label class="text-xs font-extrabold text-slate-600">×©×</label>
              <input id="ed-book-name" class="field" value="${escapeHtml(b.name)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×™×¢×“ (â‚ª)</label>
              <input id="ed-book-target" type="number" class="field" value="${b.target}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">× ×’×‘×” (â‚ª)</label>
              <input id="ed-book-raised" type="number" class="field" value="${b.raised}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">××¡' ×ª×•×¨××™×</label>
              <input id="ed-book-donors" type="number" class="field" value="${b.donors}" />
            </div>
          </div>
        `,
        `
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" onclick="closeDrawer()">×¡×’×•×¨</button>
          <button class="btn px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white" onclick="deleteBook('${lang}', ${idx})"><i class="fas fa-trash ml-2"></i>××—×§</button>
          <button class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white" onclick="saveBook('${lang}', ${idx})"><i class="fas fa-floppy-disk ml-2"></i>×©××•×¨</button>
        `
      );
    }

    function drawerDonor(idx) {
      const d = store.donors[idx];
      if (!d) return closeDrawer();

      const allBooks = [...store.books.he, ...store.books.en].map(x => x.name);

      drawerSet(
        "×ª×¨×•××”",
        `<span class="chip bg-pink-100 text-pink-700">${d.×¤×¨×•×™×§×˜}</span> <span class="chip bg-emerald-100 text-emerald-700">â‚ª${nfmt(d.××ª× ×”)}</span>`,
        `
          <div class="grid gap-3">
            <div>
              <label class="text-xs font-extrabold text-slate-600">×©× ×ª×•×¨×</label>
              <input id="ed-donor-name" class="field" value="${escapeHtml(d.×©×)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¤×¨×•×™×§×˜</label>
              <select id="ed-donor-project" class="field">
                ${allBooks.map(name => `<option ${name === d.×¤×¨×•×™×§×˜ ? "selected" : ""}>${escapeHtml(name)}</option>`).join("")}
              </select>
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¡×›×•× (â‚ª)</label>
              <input id="ed-donor-amount" type="number" class="field" value="${Number(d.××ª× ×”) || 0}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×ª××¨×™×š</label>
              <input id="ed-donor-date" type="date" class="field" value="${d.×ª××¨×™×š}" />
            </div>
          </div>
        `,
        `
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" onclick="closeDrawer()">×¡×’×•×¨</button>
          <button class="btn px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white" onclick="deleteDonor(${idx})"><i class="fas fa-trash ml-2"></i>××—×§</button>
          <button class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white" onclick="saveDonor(${idx})"><i class="fas fa-floppy-disk ml-2"></i>×©××•×¨</button>
        `
      );
    }

    function drawerExpense(idx) {
      const e = store.expenses[idx];
      if (!e) return closeDrawer();

      drawerSet(
        "×—×•×‘ ×œ×¡×¤×§",
        `<span class="chip bg-rose-100 text-rose-700">â‚ª${nfmt(e.×¡×›×•×)}</span> <span class="chip bg-slate-100 text-slate-700">${e.×¡×˜×˜×•×¡}</span>`,
        `
          <div class="grid gap-3">
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¡×¤×§</label>
              <input id="ed-expense-name" class="field" value="${escapeHtml(e.×¡×¤×§)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¡×›×•× (â‚ª)</label>
              <input id="ed-expense-amount" type="number" class="field" value="${Number(e.×¡×›×•×) || 0}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¡×˜×˜×•×¡</label>
              <select id="ed-expense-status" class="field">
                <option ${e.×¡×˜×˜×•×¡ === "×××ª×™×Ÿ" ? "selected" : ""}>×××ª×™×Ÿ</option>
                <option ${e.×¡×˜×˜×•×¡ === "×©×•×œ×" ? "selected" : ""}>×©×•×œ×</option>
              </select>
            </div>
          </div>
        `,
        `
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" onclick="closeDrawer()">×¡×’×•×¨</button>
          <button class="btn px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white" onclick="deleteExpense(${idx})"><i class="fas fa-trash ml-2"></i>××—×§</button>
          <button class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white" onclick="saveExpense(${idx})"><i class="fas fa-floppy-disk ml-2"></i>×©××•×¨</button>
          <button class="btn px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white" onclick="markAsPaid(${idx})"><i class="fas fa-check ml-2"></i>×©×•×œ×</button>
        `
      );
    }

    function drawerLogIsrael(idx) {
      const x = store.logistics.israel[idx];
      if (!x) return closeDrawer();

      drawerSet(
        "×™×¢×“ ×”×¤×¦×” ×‘××¨×¥",
        `${chipStatus(x.status)} <span class="chip bg-blue-100 text-blue-700">${x.books} ×¡×¤×¨×™×</span>`,
        `
          <div class="grid gap-3">
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¢×™×¨</label>
              <input id="ed-log-city" class="field" value="${escapeHtml(x.city)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×›××•×ª ×¡×¤×¨×™×</label>
              <input id="ed-log-books" type="number" class="field" value="${Number(x.books) || 0}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¡×˜×˜×•×¡</label>
              <select id="ed-log-status" class="field">
                <option value="×¤×¢×™×œ" ${x.status === "×¤×¢×™×œ" ? "selected" : ""}>×¤×¢×™×œ</option>
                <option value="×‘×”××ª× ×”" ${x.status === "×‘×”××ª× ×”" ? "selected" : ""}>×‘×”××ª× ×”</option>
              </select>
            </div>
          </div>
        `,
        `
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" onclick="closeDrawer()">×¡×’×•×¨</button>
          <button class="btn px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white" onclick="deleteLog('israel', ${idx})"><i class="fas fa-trash ml-2"></i>××—×§</button>
          <button class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white" onclick="saveLog('israel', ${idx})"><i class="fas fa-floppy-disk ml-2"></i>×©××•×¨</button>
        `
      );
    }

    function drawerLogInt(idx) {
      const x = store.logistics.international[idx];
      if (!x) return closeDrawer();

      drawerSet(
        "×™×¢×“ ×”×¤×¦×” ×‘×—×•×´×œ",
        `${chipStatus(x.status)} <span class="chip bg-purple-100 text-purple-700">${x.books} ×¡×¤×¨×™×</span>`,
        `
          <div class="grid gap-3">
            <div>
              <label class="text-xs font-extrabold text-slate-600">××“×™× ×”</label>
              <input id="ed-log-country" class="field" value="${escapeHtml(x.country)}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×›××•×ª ×¡×¤×¨×™×</label>
              <input id="ed-log-books" type="number" class="field" value="${Number(x.books) || 0}" />
            </div>
            <div>
              <label class="text-xs font-extrabold text-slate-600">×¡×˜×˜×•×¡</label>
              <select id="ed-log-status" class="field">
                <option value="×¤×¢×™×œ" ${x.status === "×¤×¢×™×œ" ? "selected" : ""}>×¤×¢×™×œ</option>
                <option value="×‘×©×œ×™×—×”" ${x.status === "×‘×©×œ×™×—×”" ? "selected" : ""}>×‘×©×œ×™×—×”</option>
                <option value="×‘×ª×›× ×•×Ÿ" ${x.status === "×‘×ª×›× ×•×Ÿ" ? "selected" : ""}>×‘×ª×›× ×•×Ÿ</option>
              </select>
            </div>
          </div>
        `,
        `
          <button class="btn px-4 py-2 bg-slate-100 hover:bg-slate-200" onclick="closeDrawer()">×¡×’×•×¨</button>
          <button class="btn px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white" onclick="deleteLog('international', ${idx})"><i class="fas fa-trash ml-2"></i>××—×§</button>
          <button class="btn px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white" onclick="saveLog('international', ${idx})"><i class="fas fa-floppy-disk ml-2"></i>×©××•×¨</button>
        `
      );
    }

    // =========================
    // Save/Delete actions (Drawer)
    // =========================
    function completeTask(idx) {
      if (!confirm("×œ×¡××Ÿ ××©×™××” ×›×‘×•×¦×¢×”?")) return;
      store.tasks.splice(idx, 1);
      closeDrawer();
      render();
      toast("×”××©×™××” ×¡×•×× ×” ×›×‘×•×¦×¢×” ğŸ‰");
    }

    function deleteTask(idx) {
      if (!confirm("×œ××—×•×§ ××©×™××”?")) return;
      store.tasks.splice(idx, 1);
      closeDrawer();
      render();
      toast("×”××©×™××” × ××—×§×”", "warn");
    }

    function saveTask(idx) {
      const t = store.tasks[idx];
      if (!t) return;

      const name = $("ed-task-name").value.trim();
      const manager = $("ed-task-manager").value;
      const urg = $("ed-task-urg").value;
      const range = $("ed-task-range").value;

      if (!name || !manager) return alert("× × ×œ××œ× ×©× ××©×™××” ×•××—×¨××™");

      t.××©×™××” = name;
      t.×× ×”×œ = manager;
      t.×“×—×™×¤×•×ª = urg;
      t.×˜×•×•×— = range;

      render();
      toast("×”××©×™××” ×¢×•×“×›× ×” âœ…");
    }

    function deleteStaff(idx) {
      if (!confirm("×œ××—×•×§ ×¢×•×‘×“?")) return;
      store.staff.splice(idx, 1);
      closeDrawer();
      render();
      toast("×”×¢×•×‘×“ × ××—×§", "warn");
    }

    function saveStaff(idx) {
      const s = store.staff[idx];
      if (!s) return;

      const name = $("ed-staff-name").value.trim();
      const role = $("ed-staff-role").value.trim();

      if (!name || !role) return alert("× × ×œ××œ× ×œ×¤×—×•×ª ×©× ×•×ª×¤×§×™×“");

      s.×©× = name;
      s.×ª×¤×§×™×“ = role;
      s.×˜×œ×¤×•×Ÿ = $("ed-staff-phone").value.trim();
      s.××™××™×™×œ = $("ed-staff-email").value.trim();

      render();
      toast("× ×ª×•× ×™ ×”×¢×•×‘×“ ×¢×•×“×›× ×• âœ…");
    }

    function deleteBook(lang, idx) {
      if (!confirm("×œ××—×•×§ ×¡×¤×¨/×¤×¨×•×™×§×˜?")) return;
      store.books[lang].splice(idx, 1);
      closeDrawer();
      render();
      toast("×”×¡×¤×¨ × ××—×§", "warn");
    }

    function saveBook(lang, idx) {
      const b = store.books[lang][idx];
      if (!b) return;

      const name = $("ed-book-name").value.trim();
      const target = Number($("ed-book-target").value || 0);
      const raised = Number($("ed-book-raised").value || 0);
      const donors = Number($("ed-book-donors").value || 0);

      if (!name || target <= 0) return alert("× × ×œ××œ× ×©× ×•×™×¢×“ ×—×™×•×‘×™");

      b.name = name;
      b.target = target;
      b.raised = raised;
      b.donors = donors;

      render();
      // refresh drawer visuals (percent bar)
      drawerBook(lang, idx);
      toast("×”×¡×¤×¨ ×¢×•×“×›×Ÿ âœ…");
    }

    function deleteDonor(idx) {
      if (!confirm("×œ××—×•×§ ×ª×¨×•××”?")) return;
      store.donors.splice(idx, 1);
      closeDrawer();
      render();
      toast("×”×ª×¨×•××” × ××—×§×”", "warn");
    }

    function saveDonor(idx) {
      const d = store.donors[idx];
      if (!d) return;

      const name = $("ed-donor-name").value.trim();
      const proj = $("ed-donor-project").value;
      const amount = Number($("ed-donor-amount").value || 0);
      const date = $("ed-donor-date").value;

      if (!name || !proj || amount <= 0) return alert("× × ×œ××œ× ×©×/×¤×¨×•×™×§×˜ ×•×¡×›×•× ×—×™×•×‘×™");

      d.×©× = name;
      d.×¤×¨×•×™×§×˜ = proj;
      d.××ª× ×” = amount;
      d.×ª××¨×™×š = date;

      render();
      toast("×”×ª×¨×•××” ×¢×•×“×›× ×” âœ…");
    }

    function deleteExpense(idx) {
      if (!confirm("×œ××—×•×§ ×”×•×¦××”?")) return;
      store.expenses.splice(idx, 1);
      closeDrawer();
      render();
      toast("×”×”×•×¦××” × ××—×§×”", "warn");
    }

    function saveExpense(idx) {
      const e = store.expenses[idx];
      if (!e) return;

      const name = $("ed-expense-name").value.trim();
      const amount = Number($("ed-expense-amount").value || 0);
      const status = $("ed-expense-status").value;

      if (!name || amount <= 0) return alert("× × ×œ××œ× ×¡×¤×§ ×•×¡×›×•× ×—×™×•×‘×™");

      e.×¡×¤×§ = name;
      e.×¡×›×•× = amount;
      e.×¡×˜×˜×•×¡ = status;

      render();
      toast("×”×”×•×¦××” ×¢×•×“×›× ×” âœ…");
    }

    function markAsPaid(idx) {
      if (!confirm("×œ×¡××Ÿ ×›×©×•×œ×?")) return;
      const e = store.expenses[idx];
      if (!e) return;
      e.×¡×˜×˜×•×¡ = "×©×•×œ×";
      render();
      toast("×¡×•××Ÿ ×›×©×•×œ× âœ…");
      drawerExpense(idx);
    }

    function deleteLog(group, idx) {
      if (!confirm("×œ××—×•×§ ×™×¢×“ ×”×¤×¦×”?")) return;
      store.logistics[group].splice(idx, 1);
      closeDrawer();
      render();
      toast("×”×™×¢×“ × ××—×§", "warn");
    }

    function saveLog(group, idx) {
      const x = store.logistics[group][idx];
      if (!x) return;

      if (group === "israel") {
        const city = $("ed-log-city").value.trim();
        const books = Number($("ed-log-books").value || 0);
        const status = $("ed-log-status").value;
        if (!city || books < 0) return alert("× × ×œ××œ× ×¢×™×¨ ×•×›××•×ª ×ª×§×™× ×”");
        x.city = city; x.books = books; x.status = status;
      } else {
        const country = $("ed-log-country").value.trim();
        const books = Number($("ed-log-books").value || 0);
        const status = $("ed-log-status").value;
        if (!country || books < 0) return alert("× × ×œ××œ× ××“×™× ×” ×•×›××•×ª ×ª×§×™× ×”");
        x.country = country; x.books = books; x.status = status;
      }
      render();
      toast("×™×¢×“ ×”×”×¤×¦×” ×¢×•×“×›×Ÿ âœ…");
    }

    // =========================
    // Add Modal (smart per tab)
    // =========================
    function openAddModal() {
      $("modal-wrap").classList.remove("hidden");
      $("modal-title").innerText = addLabels[state.tab] || "×”×•×¡×£";

      const body = $("modal-body");
      const today = new Date().toISOString().split("T")[0];

      if (state.tab === "tasks") {
        body.innerHTML = `
          <input id="m-task-name" class="field" placeholder="×ª×™××•×¨ ×”××©×™××”" />
          <select id="m-task-manager" class="field">
            <option value="">×‘×—×¨ ××—×¨××™...</option>
            ${store.staff.map(s => `<option>${s.×©×}</option>`).join("")}
          </select>
          <select id="m-task-urg" class="field">
            <option value="×¨×’×™×œ×”">×“×—×™×¤×•×ª ×¨×’×™×œ×”</option>
            <option value="×’×‘×•×”×”">×“×—×™×¤×•×ª ×’×‘×•×”×” ğŸ”¥</option>
          </select>
          <select id="m-task-range" class="field">
            <option value="×—×•×“×©×™">×—×•×“×©×™</option>
            <option value="××¨×•×š">×˜×•×•×— ××¨×•×š</option>
          </select>
        `;
        $("modal-save").onclick = () => {
          const name = $("m-task-name").value.trim();
          const manager = $("m-task-manager").value;
          if (!name || !manager) return alert("× × ×œ××œ× ×ª×™××•×¨ ×•××—×¨××™");
          store.tasks.push({ ××©×™××”: name, ×× ×”×œ: manager, ×“×—×™×¤×•×ª: $("m-task-urg").value, ×˜×•×•×—: $("m-task-range").value });
          closeModal(); render(); toast("××©×™××” × ×•×¡×¤×” âœ¨");
        };

      } else if (state.tab === "staff") {
        body.innerHTML = `
          <input id="m-staff-name" class="field" placeholder="×©× ×”×¢×•×‘×“" />
          <input id="m-staff-role" class="field" placeholder="×ª×¤×§×™×“" />
          <input id="m-staff-phone" class="field" placeholder="×˜×œ×¤×•×Ÿ" />
          <input id="m-staff-email" class="field" placeholder="××™××™×™×œ" />
        `;
        $("modal-save").onclick = () => {
          const name = $("m-staff-name").value.trim();
          const role = $("m-staff-role").value.trim();
          if (!name || !role) return alert("× × ×œ××œ× ×œ×¤×—×•×ª ×©× ×•×ª×¤×§×™×“");
          store.staff.push({ ×©×: name, ×ª×¤×§×™×“: role, ×˜×œ×¤×•×Ÿ: $("m-staff-phone").value.trim(), ××™××™×™×œ: $("m-staff-email").value.trim() });
          closeModal(); render(); toast("×¢×•×‘×“ × ×•×¡×£ âœ¨");
        };

      } else if (state.tab === "donors") {
        const allBooks = [...store.books.he, ...store.books.en].map(b => b.name);
        body.innerHTML = `
          <input id="m-donor-name" class="field" placeholder="×©× ×”×ª×•×¨×" />
          <select id="m-donor-project" class="field">
            <option value="">×‘×—×¨ ×¤×¨×•×™×§×˜/×¡×¤×¨...</option>
            ${allBooks.map(n => `<option>${escapeHtml(n)}</option>`).join("")}
          </select>
          <input id="m-donor-amount" type="number" class="field" placeholder="×¡×›×•× ×”×ª×¨×•××” (â‚ª)" />
          <input id="m-donor-date" type="date" class="field" value="${today}" />
        `;
        $("modal-save").onclick = () => {
          const name = $("m-donor-name").value.trim();
          const proj = $("m-donor-project").value;
          const amount = Number($("m-donor-amount").value || 0);
          if (!name || !proj || amount <= 0) return alert("× × ×œ××œ× ×©×/×¤×¨×•×™×§×˜ ×•×¡×›×•× ×—×™×•×‘×™");
          store.donors.push({ ×©×: name, ×¤×¨×•×™×§×˜: proj, ××ª× ×”: amount, ×ª××¨×™×š: $("m-donor-date").value });
          closeModal(); render(); toast("×ª×¨×•××” × ×•×¡×¤×” âœ¨");
        };

      } else if (state.tab === "expenses") {
        body.innerHTML = `
          <input id="m-exp-name" class="field" placeholder="×©× ×”×¡×¤×§" />
          <input id="m-exp-amount" type="number" class="field" placeholder="×¡×›×•× ×”×—×•×‘ (â‚ª)" />
        `;
        $("modal-save").onclick = () => {
          const name = $("m-exp-name").value.trim();
          const amount = Number($("m-exp-amount").value || 0);
          if (!name || amount <= 0) return alert("× × ×œ××œ× ×¡×¤×§ ×•×¡×›×•× ×—×™×•×‘×™");
          store.expenses.push({ ×¡×¤×§: name, ×¡×›×•×: amount, ×¡×˜×˜×•×¡: "×××ª×™×Ÿ" });
          closeModal(); render(); toast("×”×•×¦××” × ×•×¡×¤×” âœ¨");
        };

      } else if (state.tab === "books-he" || state.tab === "books-en") {
        const lang = state.tab.endsWith("he") ? "he" : "en";
        body.innerHTML = `
          <input id="m-book-name" class="field" placeholder="×©× ×”×¡×¤×¨" />
          <input id="m-book-target" type="number" class="field" placeholder="×™×¢×“ ×’×™×•×¡ (â‚ª)" value="50000" />
          <input id="m-book-raised" type="number" class="field" placeholder="× ×’×‘×” ×¢×“ ×¢×›×©×™×• (â‚ª)" value="0" />
          <input id="m-book-donors" type="number" class="field" placeholder="××¡×¤×¨ ×ª×•×¨××™×" value="0" />
        `;
        $("modal-save").onclick = () => {
          const name = $("m-book-name").value.trim();
          const target = Number($("m-book-target").value || 0);
          const raised = Number($("m-book-raised").value || 0);
          const donors = Number($("m-book-donors").value || 0);
          if (!name || target <= 0) return alert("× × ×œ××œ× ×©× ×•×™×¢×“ ×—×™×•×‘×™");
          store.books[lang].push({ name, target, raised, donors });
          closeModal(); render(); toast("×¡×¤×¨ × ×•×¡×£ âœ¨");
        };

      } else if (state.tab === "logistics") {
        body.innerHTML = `
          <div class="card p-4 border border-slate-200">
            <div class="font-extrabold text-slate-800">×‘×—×¨ ×¡×•×’ ×™×¢×“</div>
            <div class="text-xs text-slate-500 font-bold mt-1">××¤×©×¨ ×œ×”×•×¡×™×£ ×™×¢×“ ×‘××¨×¥ ××• ×‘×—×•×´×œ</div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <button class="btn px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white" id="m-log-type-il">
              <i class="fas fa-location-dot ml-2"></i> ×™×¢×“ ×‘××¨×¥
            </button>
            <button class="btn px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white" id="m-log-type-int">
              <i class="fas fa-globe ml-2"></i> ×™×¢×“ ×‘×—×•×´×œ
            </button>
          </div>

          <div id="m-log-fields" class="space-y-3"></div>
        `;

        let current = null;
        const fields = $("m-log-fields");

        const paint = (type) => {
          current = type;
          if (type === "il") {
            fields.innerHTML = `
              <input id="m-log-city" class="field" placeholder="×¢×™×¨" />
              <input id="m-log-books" type="number" class="field" placeholder="××¡×¤×¨ ×¡×¤×¨×™×" value="0" />
              <select id="m-log-status" class="field">
                <option value="×¤×¢×™×œ">×¤×¢×™×œ</option>
                <option value="×‘×”××ª× ×”">×‘×”××ª× ×”</option>
              </select>
            `;
          } else {
            fields.innerHTML = `
              <input id="m-log-country" class="field" placeholder="××“×™× ×”" />
              <input id="m-log-books" type="number" class="field" placeholder="××¡×¤×¨ ×¡×¤×¨×™×" value="0" />
              <select id="m-log-status" class="field">
                <option value="×¤×¢×™×œ">×¤×¢×™×œ</option>
                <option value="×‘×©×œ×™×—×”">×‘×©×œ×™×—×”</option>
                <option value="×‘×ª×›× ×•×Ÿ">×‘×ª×›× ×•×Ÿ</option>
              </select>
            `;
          }
        };

        $("m-log-type-il").onclick = () => paint("il");
        $("m-log-type-int").onclick = () => paint("int");

        // default
        paint("il");

        $("modal-save").onclick = () => {
          const books = Number($("m-log-books").value || 0);
          const status = $("m-log-status").value;

          if (current === "il") {
            const city = $("m-log-city").value.trim();
            if (!city) return alert("× × ×œ××œ× ×¢×™×¨");
            store.logistics.israel.push({ city, books, status });
          } else {
            const country = $("m-log-country").value.trim();
            if (!country) return alert("× × ×œ××œ× ××“×™× ×”");
            store.logistics.international.push({ country, books, status });
          }

          closeModal(); render(); toast("×™×¢×“ ×”×¤×¦×” × ×•×¡×£ âœ¨");
        };
      }
    }

    function closeModal() { $("modal-wrap").classList.add("hidden"); }

    // =========================
    // Event Delegation
    // =========================
    document.addEventListener("click", (e) => {
      const nav = e.target.closest(".nav-item");
      if (nav?.dataset?.tab) {
        state.tab = nav.dataset.tab;
        state.search = "";
        $("search").value = "";
        render();
      }

      const open = e.target.closest("[data-open]");
      if (open) {
        const type = open.dataset.open;
        const index = Number(open.dataset.index);
        const lang = open.dataset.lang;
        openDrawer({ type, index, lang });
      }

      if (e.target.closest("[data-close]")) closeDrawer();
      if (e.target.closest("[data-modal-close]")) closeModal();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeDrawer();
        closeModal();
      }
    });

    // Search
    $("search").addEventListener("input", (e) => {
      state.search = e.target.value || "";
      render();
    });

    // Buttons
    $("btn-add").addEventListener("click", openAddModal);
    $("btn-refresh").addEventListener("click", () => {
      render();
      toast("×¨×¢× ×•×Ÿ ×‘×•×¦×¢ âœ…", "info");
    });

    // Accessibility: open card with Enter
    document.addEventListener("keydown", (e) => {
      if (e.key !== "Enter") return;
      const card = e.target.closest("[data-open]");
      if (card) {
        const type = card.dataset.open;
        const index = Number(card.dataset.index);
        const lang = card.dataset.lang;
        openDrawer({ type, index, lang });
      }
    });

    // Safe HTML for inputs
    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // Init
    window.onload = () => {
      setActiveNav(state.tab);
      render();
    };
  </script>
</body>
</html>
