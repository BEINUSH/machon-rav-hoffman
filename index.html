<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>××›×•×Ÿ ×¨×‘ ×”×•×¤××Ÿ - ××¢×¨×›×ª × ×™×”×•×œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&display=swap');
    body{font-family:'Assistant',sans-serif;background:#f8fafc;color:#1e293b}
    .sidebar-link{transition:all .2s;border-radius:.5rem;margin:.25rem 0;display:flex;align-items:center;padding:.75rem 1rem;cursor:pointer}
    .sidebar-link:hover{background:#334155;color:#fff}
    .sidebar-link.active{background:#3b82f6;color:#fff}
    .card{background:#fff;border-radius:1rem;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);padding:1.5rem}
    .fade-in{animation:fadeIn .4s ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .hover-scale{transition:transform .2s}
    .hover-scale:hover{transform:scale(1.02)}
    .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.15rem .55rem;border-radius:999px;font-size:.75rem;font-weight:700}
  </style>
</head>
<body class="flex h-screen overflow-hidden">
  <aside class="w-72 bg-slate-800 text-slate-300 flex flex-col shadow-2xl z-20 overflow-y-auto">
    <div class="p-6 border-b border-slate-700">
      <h1 class="text-white text-xl font-bold">××›×•×Ÿ ×¨×‘ ×”×•×¤××Ÿ</h1>
      <p class="text-[10px] text-slate-400 mt-1 uppercase">× ×™×”×•×œ ×•×”×•×¦××” ×œ××•×¨</p>
    </div>
    <nav class="flex-1 p-4 text-sm space-y-1">
      <div class="text-[10px] font-bold text-slate-500 px-4 mb-2 uppercase">× ×™×”×•×œ</div>
      <div onclick="switchTab('tasks')" class="nav-item sidebar-link active" id="btn-tasks">
        <i class="fas fa-list-ul ml-3"></i> ××©×™××•×ª
      </div>
      <div onclick="switchTab('ideas')" class="nav-item sidebar-link" id="btn-ideas">
        <i class="fas fa-lightbulb ml-3"></i> ×¨×¢×™×•× ×•×ª
        <span id="ideas-badge" class="mr-auto bg-yellow-400 text-slate-900 px-2 py-0.5 rounded-full text-[10px]">0</span>
      </div>
      <div onclick="switchTab('staff')" class="nav-item sidebar-link" id="btn-staff">
        <i class="fas fa-users ml-3"></i> ×¦×•×•×ª
      </div>
      <div class="text-[10px] font-bold text-slate-500 px-4 mt-6 mb-2 uppercase">×¡×¤×¨×™×</div>
      <div onclick="switchTab('books')" class="nav-item sidebar-link" id="btn-books">
        <i class="fas fa-book ml-3"></i> ×›×œ ×”×¡×¤×¨×™×
      </div>
      <div class="text-[10px] font-bold text-slate-500 px-4 mt-6 mb-2 uppercase">×›×¡×¤×™×</div>
      <div onclick="switchTab('donors')" class="nav-item sidebar-link" id="btn-donors">
        <i class="fas fa-hand-holding-heart ml-3"></i> ×ª×•×¨××™×
      </div>
      <div onclick="switchTab('expenses')" class="nav-item sidebar-link" id="btn-expenses">
        <i class="fas fa-file-invoice ml-3"></i> ×”×•×¦××•×ª
      </div>
    </nav>
    <div class="p-4 bg-slate-900 border-t border-slate-700 space-y-2">
      <button onclick="exportData()" class="w-full bg-emerald-700 hover:bg-emerald-600 text-white px-3 py-2 rounded-lg text-xs font-bold">
        <i class="fas fa-download ml-2"></i> ×™×™×¦×•×
      </button>
      <button onclick="resetData()" class="w-full bg-slate-800 hover:bg-slate-700 text-white px-3 py-2 rounded-lg text-xs font-bold">
        <i class="fas fa-eraser ml-2"></i> × ×™×§×•×™
      </button>
    </div>
  </aside>

  <main class="flex-1 flex flex-col">
    <header class="h-16 bg-white border-b flex items-center justify-between px-8 shadow-sm">
      <h2 id="page-title" class="text-lg font-bold">××©×™××•×ª ×•×œ×•×´×–</h2>
      <div class="flex gap-3">
        <button onclick="showAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold">
          <i class="fas fa-plus ml-2"></i><span id="add-text">×”×•×¡×£</span>
        </button>
        <button onclick="showEditModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-bold">
          <i class="fas fa-edit ml-2"></i> ×¢×¨×•×š
        </button>
      </div>
    </header>
    <div id="content" class="p-8 overflow-y-auto flex-1 bg-slate-50"></div>
  </main>

  <div id="modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
      <div class="p-6 border-b flex items-center justify-between">
        <h3 id="modal-title" class="text-xl font-bold">×”×•×¡×¤×”</h3>
        <button onclick="hideModal()" class="text-slate-400 hover:text-slate-700"><i class="fas fa-times text-xl"></i></button>
      </div>
      <div class="p-6 overflow-y-auto flex-1" id="modal-body"></div>
      <div class="p-6 border-t flex justify-end gap-3">
        <button onclick="hideModal()" class="px-6 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold">×‘×™×˜×•×œ</button>
        <button onclick="submitModal()" id="modal-submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">
          <i class="fas fa-check ml-2"></i> ×©××•×¨
        </button>
      </div>
    </div>
  </div>

  <script>
const KEY='hoffman_v2';
const uid=()=>Math.random().toString(36).slice(2,9);
const money=n=>`â‚ª${Number(n||0).toLocaleString()}`;
const today=()=>new Date().toISOString().split('T')[0];
const esc=s=>String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));

let store={
  tasks:[
    {id:uid(),××©×™××”:"×”×›× ×ª ×—×©×‘×•× ×•×ª ×ª×•×¨××™×",×× ×”×œ:"××©×” ×›×”×Ÿ",×“×—×™×¤×•×ª:"×’×‘×•×”×”",×˜×•×•×—:"×—×•×“×©×™"},
    {id:uid(),××©×™××”:"×¢×“×›×•×Ÿ × ×™×•×–×œ×˜×¨",×× ×”×œ:"×™×•×¡×™ ×œ×•×™",×“×—×™×¤×•×ª:"×’×‘×•×”×”",×˜×•×•×—:"×—×•×“×©×™"},
    {id:uid(),××©×™××”:"×‘×™×§×•×¨ ××¦×œ ××•×´×œ",×× ×”×œ:"×“×•×“ ×’×•×œ×“",×“×—×™×¤×•×ª:"×¨×’×™×œ×”",×˜×•×•×—:"××¨×•×š"}
  ],
  ideas:[
    {id:uid(),×›×•×ª×¨×ª:"×¤×•×“×§××¡×˜ ×©×‘×•×¢×™",×ª×™××•×¨:"×¤×•×“×§××¡×˜ ×¢×œ × ×•×©××™ ×—×™× ×•×š",××¦×™×¢:"×™×•×¡×™ ×œ×•×™",×ª××¨×™×š:today(),×¡×˜×˜×•×¡:"×—×“×©",×”×¦×‘×¢×•×ª:5,×§×˜×’×•×¨×™×”:"×©×™×•×•×§"},
    {id:uid(),×›×•×ª×¨×ª:"××¢×¨×›×ª CRM",×ª×™××•×¨:"× ×™×”×•×œ ×§×©×¨×™ ×ª×•×¨××™×",××¦×™×¢:"××©×” ×›×”×Ÿ",×ª××¨×™×š:today(),×¡×˜×˜×•×¡:"×‘×‘×“×™×§×”",×”×¦×‘×¢×•×ª:8,×§×˜×’×•×¨×™×”:"×˜×›× ×•×œ×•×’×™×”"}
  ],
  staff:[
    {×©×:"××©×” ×›×”×Ÿ",×ª×¤×§×™×“:"×× ×”×œ ×›×œ×œ×™",×˜×œ×¤×•×Ÿ:"050-1234567",××™××™×™×œ:"moshe@hoffman.org"},
    {×©×:"×™×•×¡×™ ×œ×•×™",×ª×¤×§×™×“:"×× ×”×œ ×©×™×•×•×§",×˜×œ×¤×•×Ÿ:"052-7654321",××™××™×™×œ:"yossi@hoffman.org"},
    {×©×:"×“×•×“ ×’×•×œ×“",×ª×¤×§×™×“:"×œ×•×’×™×¡×˜×™×§×”",×˜×œ×¤×•×Ÿ:"054-9876543",××™××™×™×œ:"david@hoffman.org"}
  ],
  books:[
    {id:"b1",name:"×”××—×•× ×š",progress:90,target:25000,raised:22500,lang:"he"},
    {id:"b2",name:"×™×¡×•×“×•×ª ×”×—×™× ×•×š",progress:65,target:50000,raised:32500,lang:"he"},
    {id:"b3",name:"Awareness",progress:70,target:60000,raised:42000,lang:"en"}
  ],
  donors:[
    {×©×:"××‘×¨×”× ×›×”×Ÿ",×¤×¨×•×™×§×˜:"×”××—×•× ×š",××ª× ×”:"5000",×ª××¨×™×š:today()},
    {×©×:"×©×¨×” ×œ×•×™",×¤×¨×•×™×§×˜:"×™×¡×•×“×•×ª",××ª× ×”:"3500",×ª××¨×™×š:today()}
  ],
  expenses:[
    {×¡×¤×§:"×“×¤×•×¡ ××¨×›×–",×¡×›×•×:"12500"},
    {×¡×¤×§:"××©×¨×“ - ×©×›×¨",×¡×›×•×:"8000"}
  ]
};

function save(){
  try{localStorage.setItem(KEY,JSON.stringify(store));updateBadge()}catch(e){}
}
function load(){
  try{const d=localStorage.getItem(KEY);if(d){const l=JSON.parse(d);if(!l.ideas)l.ideas=store.ideas;store=l}}catch(e){}
}
function resetData(){
  if(confirm('×œ××—×•×§ ×”×›×œ?')){localStorage.removeItem(KEY);location.reload()}
}
function exportData(){
  const blob=new Blob([JSON.stringify(store,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`hoffman-${today()}.json`;
  a.click();
  URL.revokeObjectURL(url);
  notify('×”× ×ª×•× ×™× ×™×•×¦××•!');
}

let tab='tasks';
function switchTab(t){
  tab=t;
  document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
  document.getElementById('btn-'+t)?.classList.add('active');
  const titles={tasks:'××©×™××•×ª',ideas:'×¨×¢×™×•× ×•×ª',staff:'×¦×•×•×ª',books:'×¡×¤×¨×™×',donors:'×ª×•×¨××™×',expenses:'×”×•×¦××•×ª'};
  document.getElementById('page-title').innerText=titles[t]||'';
  document.getElementById('add-text').innerText=t==='ideas'?'×¨×¢×™×•×Ÿ ×—×“×©':'×”×•×¡×£ ×—×“×©';
  render();
}

function render(){
  const el=document.getElementById('content');
  el.classList.remove('fade-in');
  void el.offsetWidth;
  el.classList.add('fade-in');
  
  if(tab==='tasks')renderTasks(el);
  else if(tab==='ideas')renderIdeas(el);
  else if(tab==='staff')renderStaff(el);
  else if(tab==='books')renderBooks(el);
  else if(tab==='donors')renderDonors(el);
  else if(tab==='expenses')renderExpenses(el);
}

function renderTasks(el){
  const high=store.tasks.filter(t=>t.×“×—×™×¤×•×ª==='×’×‘×•×”×”');
  el.innerHTML=`
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="card border-r-8 border-red-500">
        <h4 class="font-bold text-red-600 mb-4 text-lg flex items-center">
          <i class="fas fa-fire ml-2"></i> ×“×—×•×£
          <span class="mr-auto bg-red-100 text-red-600 px-3 py-1 rounded-full text-xs">${high.length}</span>
        </h4>
        ${high.map((t,i)=>`
          <div onclick="editTask(${store.tasks.indexOf(t)})" class="p-4 bg-red-50 rounded-lg mb-3 cursor-pointer hover:bg-red-100 border border-red-200">
            <div class="font-bold">${esc(t.××©×™××”)}</div>
            <div class="text-xs text-slate-600 mt-1">××—×¨××™: ${esc(t.×× ×”×œ)}</div>
          </div>
        `).join('')||'<p class="text-slate-400 text-center py-8">××™×Ÿ ×“×—×•×¤×•×ª ğŸ‰</p>'}
      </div>
      <div class="card">
        <h4 class="font-bold mb-4 text-lg">×›×œ ×”××©×™××•×ª</h4>
        <div class="divide-y">
          ${store.tasks.map((t,i)=>`
            <div onclick="editTask(${i})" class="p-3 flex justify-between items-center cursor-pointer hover:bg-slate-50">
              <span class="font-bold">${esc(t.××©×™××”)}</span>
              <span class="chip bg-blue-50 text-blue-700">${esc(t.×× ×”×œ)}</span>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;
}

function renderIdeas(el){
  const byStatus={×—×“×©:[],×‘×‘×“×™×§×”:[],××•×©×¨:[],× ×“×—×”:[]};
  store.ideas.forEach(i=>byStatus[i.×¡×˜×˜×•×¡]?.push(i));
  el.innerHTML=`
    <div class="grid grid-cols-4 gap-4 mb-6">
      <div class="card bg-yellow-500 text-white"><div class="text-xs uppercase opacity-80">×—×“×©×™×</div><div class="text-4xl font-bold">${byStatus.×—×“×©.length}</div></div>
      <div class="card bg-blue-500 text-white"><div class="text-xs uppercase opacity-80">×‘×‘×“×™×§×”</div><div class="text-4xl font-bold">${byStatus.×‘×‘×“×™×§×”.length}</div></div>
      <div class="card bg-green-500 text-white"><div class="text-xs uppercase opacity-80">××•×©×¨×•</div><div class="text-4xl font-bold">${byStatus.××•×©×¨.length}</div></div>
      <div class="card bg-red-500 text-white"><div class="text-xs uppercase opacity-80">× ×“×—×•</div><div class="text-4xl font-bold">${byStatus.× ×“×—×”.length}</div></div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      ${store.ideas.sort((a,b)=>b.×”×¦×‘×¢×•×ª-a.×”×¦×‘×¢×•×ª).map((idea,i)=>`
        <div class="card hover-scale border-r-4 ${idea.×¡×˜×˜×•×¡==='×—×“×©'?'border-yellow-500':idea.×¡×˜×˜×•×¡==='××•×©×¨'?'border-green-500':'border-slate-300'}">
          <div class="flex items-start justify-between mb-3">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <h4 class="font-bold text-lg">${esc(idea.×›×•×ª×¨×ª)}</h4>
                <span class="chip ${idea.×¡×˜×˜×•×¡==='×—×“×©'?'bg-yellow-100 text-yellow-700':idea.×¡×˜×˜×•×¡==='×‘×‘×“×™×§×”'?'bg-blue-100 text-blue-700':idea.×¡×˜×˜×•×¡==='××•×©×¨'?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}">${idea.×¡×˜×˜×•×¡}</span>
              </div>
              <p class="text-sm text-slate-600">${esc(idea.×ª×™××•×¨)}</p>
            </div>
          </div>
          <div class="flex items-center text-xs text-slate-500 mb-3">
            <span><i class="fas fa-user ml-1"></i> ${esc(idea.××¦×™×¢)}</span>
            <span class="mr-3"><i class="fas fa-tag ml-1"></i> ${idea.×§×˜×’×•×¨×™×”}</span>
          </div>
          <div class="flex gap-2">
            <button onclick="voteIdea(${i})" class="px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-bold">
              <i class="fas fa-thumbs-up ml-1"></i> ${idea.×”×¦×‘×¢×•×ª}
            </button>
            ${idea.×¡×˜×˜×•×¡!=='××•×©×¨'&&idea.×¡×˜×˜×•×¡!=='× ×“×—×”'?`
              <button onclick="approveIdea(${i})" class="flex-1 px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-bold">
                <i class="fas fa-check ml-2"></i> ××©×¨ â†’ ××©×™××”
              </button>
            `:''}
            <button onclick="editIdea(${i})" class="px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-sm font-bold">
              <i class="fas fa-edit"></i>
            </button>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

function renderStaff(el){
  el.innerHTML=`
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      ${store.staff.map((s,i)=>{
        const tasks=store.tasks.filter(t=>t.×× ×”×œ===s.×©×).length;
        return`
          <div onclick="editStaff(${i})" class="card hover-scale border-b-4 border-blue-500 cursor-pointer">
            <div class="flex items-center mb-4">
              <div class="p-3 rounded-full bg-blue-50 text-blue-600"><i class="fas fa-user-tie"></i></div>
              <div class="mr-3">
                <div class="font-bold text-lg">${esc(s.×©×)}</div>
                <div class="text-xs text-slate-400 uppercase">${esc(s.×ª×¤×§×™×“)}</div>
              </div>
              <span class="chip bg-blue-50 text-blue-700 mr-auto"><i class="fas fa-tasks"></i> ${tasks}</span>
            </div>
            <div class="text-xs space-y-1 text-slate-600">
              <div><i class="fas fa-phone ml-2 text-blue-600"></i> ${esc(s.×˜×œ×¤×•×Ÿ)}</div>
              <div><i class="fas fa-envelope ml-2 text-blue-600"></i> ${esc(s.××™××™×™×œ)}</div>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

function renderBooks(el){
  el.innerHTML=`
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      ${store.books.map((b,i)=>`
        <div onclick="editBook(${i})" class="card border-t-4 border-blue-600 hover-scale cursor-pointer">
          <div class="flex justify-between items-start mb-4">
            <h4 class="font-bold text-lg">${esc(b.name)}</h4>
            <span class="chip bg-slate-100 text-slate-700">${b.lang==='he'?'×¢×‘×¨×™×ª':'English'}</span>
          </div>
          <div class="w-full bg-slate-100 h-3 rounded-full mb-3">
            <div class="bg-emerald-500 h-full rounded-full" style="width:${b.progress}%"></div>
          </div>
          <div class="flex justify-between text-sm mb-4">
            <span class="font-bold text-emerald-600">${money(b.raised)}</span>
            <span class="text-slate-400">×™×¢×“: ${money(b.target)}</span>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

function renderDonors(el){
  const total=store.donors.reduce((s,d)=>s+parseInt(d.××ª× ×”||0),0);
  el.innerHTML=`
    <div class="grid grid-cols-3 gap-6 mb-8">
      <div class="card bg-emerald-500 text-white">
        <div class="text-xs uppercase opacity-80">×¡×”×´×› ×’×™×•×¡</div>
        <div class="text-4xl font-bold">${money(total)}</div>
      </div>
      <div class="card bg-blue-500 text-white">
        <div class="text-xs uppercase opacity-80">×ª×•×¨××™×</div>
        <div class="text-4xl font-bold">${store.donors.length}</div>
      </div>
      <div class="card bg-purple-500 text-white">
        <div class="text-xs uppercase opacity-80">×××•×¦×¢</div>
        <div class="text-4xl font-bold">${money(Math.round(total/Math.max(1,store.donors.length)))}</div>
      </div>
    </div>
    <div class="card">
      <h4 class="font-bold mb-4 text-lg">×¨×©×™××ª ×ª×•×¨××™×</h4>
      <table class="w-full text-sm">
        <thead class="bg-slate-50 text-slate-400 text-xs uppercase">
          <tr><th class="p-3 text-right">×©×</th><th class="p-3 text-right">×¤×¨×•×™×§×˜</th><th class="p-3 text-right">×ª××¨×™×š</th><th class="p-3 text-right">×¡×›×•×</th></tr>
        </thead>
        <tbody>
          ${store.donors.map((d,i)=>`
            <tr class="border-b hover:bg-slate-50 cursor-pointer" onclick="editDonor(${i})">
              <td class="p-3 font-bold">${esc(d.×©×)}</td>
              <td class="p-3 text-slate-600">${esc(d.×¤×¨×•×™×§×˜)}</td>
              <td class="p-3 text-slate-400">${d.×ª××¨×™×š}</td>
              <td class="p-3 font-bold text-emerald-600">${money(parseInt(d.××ª× ×”||0))}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}

function renderExpenses(el){
  const total=store.expenses.reduce((s,e)=>s+parseInt(e.×¡×›×•×||0),0);
  el.innerHTML=`
    <div class="card bg-red-50 border-r-4 border-red-500 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-xs text-red-400 uppercase font-bold">×¡×”×´×› ×—×•×‘×•×ª</div>
          <div class="text-4xl font-bold text-red-600">${money(total)}</div>
        </div>
        <i class="fas fa-exclamation-triangle text-red-300 text-5xl"></i>
      </div>
    </div>
    <div class="card">
      <h4 class="font-bold mb-4 text-lg">×¨×©×™××ª ×—×•×‘×•×ª</h4>
      <table class="w-full text-sm">
        <thead class="bg-slate-50 text-slate-400 text-xs uppercase">
          <tr><th class="p-3 text-right">×¡×¤×§</th><th class="p-3 text-left">×¡×›×•×</th><th class="p-3 text-left">×¤×¢×•×œ×•×ª</th></tr>
        </thead>
        <tbody>
          ${store.expenses.map((e,i)=>`
            <tr class="border-b hover:bg-slate-50">
              <td class="p-3 font-bold">${esc(e.×¡×¤×§)}</td>
              <td class="p-3 text-left"><span class="chip bg-red-100 text-red-700">${money(parseInt(e.×¡×›×•×||0))}</span></td>
              <td class="p-3 text-left">
                <button onclick="markPaid(${i})" class="text-green-600 hover:underline text-xs font-bold">
                  <i class="fas fa-check ml-1"></i> ×©×•×œ×
                </button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}

function updateBadge(){
  const newIdeas=store.ideas.filter(i=>i.×¡×˜×˜×•×¡==='×—×“×©').length;
  document.getElementById('ideas-badge').innerText=newIdeas;
}

function voteIdea(i){
  store.ideas[i].×”×¦×‘×¢×•×ª++;
  save();
  render();
  notify('×”×¦×‘×¢×” × ×¨×©××”!');
}

function approveIdea(i){
  const idea=store.ideas[i];
  if(confirm(`×œ×”×¤×•×š "${idea.×›×•×ª×¨×ª}" ×œ××©×™××”?`)){
    store.tasks.unshift({
      id:uid(),
      ××©×™××”:idea.×›×•×ª×¨×ª+' (××¨×¢×™×•×Ÿ)',
      ×× ×”×œ:idea.××¦×™×¢,
      ×“×—×™×¤×•×ª:'×¨×’×™×œ×”',
      ×˜×•×•×—:'××¨×•×š'
    });
    store.ideas[i].×¡×˜×˜×•×¡='××•×©×¨';
    save();
    notify('×”×¨×¢×™×•×Ÿ ××•×©×¨ ×•×”×¤×š ×œ××©×™××”!');
    render();
  }
}

function markPaid(i){
  if(confirm('×œ×¡××Ÿ ×›×©×•×œ×?')){
    store.expenses.splice(i,1);
    save();
    render();
    notify('×”×—×•×‘ ×¡×•××Ÿ ×›×©×•×œ×!');
  }
}

function showAddModal(){
  document.getElementById('modal').classList.remove('hidden');
  const title=document.getElementById('modal-title');
  const body=document.getElementById('modal-body');
  
  if(tab==='tasks'){
    title.innerText='××©×™××” ×—×“×©×”';
    body.innerHTML=`
      <input id="m-task" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×ª×™××•×¨ ×”××©×™××”">
      <select id="m-manager" class="w-full p-3 border-2 rounded-lg mb-3">
        <option value="">×‘×—×¨ ×× ×”×œ...</option>
        ${store.staff.map(s=>`<option value="${esc(s.×©×)}">${esc(s.×©×)}</option>`).join('')}
      </select>
      <select id="m-urgency" class="w-full p-3 border-2 rounded-lg mb-3">
        <option value="×¨×’×™×œ×”">×¨×’×™×œ×”</option>
        <option value="×’×‘×•×”×”">×’×‘×•×”×” ğŸ”¥</option>
      </select>
      <select id="m-timeframe" class="w-full p-3 border-2 rounded-lg">
        <option value="×—×•×“×©×™">×—×•×“×©×™</option>
        <option value="××¨×•×š">××¨×•×š</option>
      </select>
    `;
  }
  else if(tab==='ideas'){
    title.innerText='×¨×¢×™×•×Ÿ ×—×“×©';
    body.innerHTML=`
      <input id="m-title" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×›×•×ª×¨×ª ×”×¨×¢×™×•×Ÿ">
      <textarea id="m-desc" class="w-full p-3 border-2 rounded-lg mb-3" rows="4" placeholder="×ª×™××•×¨ ××¤×•×¨×˜"></textarea>
      <select id="m-proposer" class="w-full p-3 border-2 rounded-lg mb-3">
        <option value="">××™ ××¦×™×¢?</option>
        ${store.staff.map(s=>`<option value="${esc(s.×©×)}">${esc(s.×©×)}</option>`).join('')}
      </select>
      <select id="m-category" class="w-full p-3 border-2 rounded-lg">
        <option value="×©×™×•×•×§">×©×™×•×•×§</option>
        <option value="×˜×›× ×•×œ×•×’×™×”">×˜×›× ×•×œ×•×’×™×”</option>
        <option value="×ª×•×›×Ÿ">×ª×•×›×Ÿ</option>
        <option value="× ×™×”×•×œ">× ×™×”×•×œ</option>
      </select>
    `;
  }
  else if(tab==='staff'){
    title.innerText='×¢×•×‘×“ ×—×“×©';
    body.innerHTML=`
      <input id="m-name" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×©× ××œ×">
      <input id="m-role" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×ª×¤×§×™×“">
      <input id="m-phone" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×˜×œ×¤×•×Ÿ">
      <input id="m-email" class="w-full p-3 border-2 rounded-lg" placeholder="××™××™×™×œ">
    `;
  }
  else if(tab==='books'){
    title.innerText='×¡×¤×¨ ×—×“×©';
    body.innerHTML=`
      <input id="m-name" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×©× ×”×¡×¤×¨">
      <select id="m-lang" class="w-full p-3 border-2 rounded-lg mb-3">
        <option value="he">×¢×‘×¨×™×ª</option>
        <option value="en">English</option>
      </select>
      <input id="m-target" type="number" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×™×¢×“ ×’×™×•×¡" value="50000">
      <input id="m-raised" type="number" class="w-full p-3 border-2 rounded-lg" placeholder="×›×‘×¨ × ×’×‘×”" value="0">
    `;
  }
  else if(tab==='donors'){
    title.innerText='×ª×¨×•××” ×—×“×©×”';
    body.innerHTML=`
      <input id="m-name" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×©× ×”×ª×•×¨×">
      <select id="m-project" class="w-full p-3 border-2 rounded-lg mb-3">
        <option value="">×‘×—×¨ ×¤×¨×•×™×§×˜...</option>
        ${store.books.map(b=>`<option value="${esc(b.name)}">${esc(b.name)}</option>`).join('')}
      </select>
      <input id="m-amount" type="number" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×¡×›×•×">
      <input id="m-date" type="date" class="w-full p-3 border-2 rounded-lg" value="${today()}">
    `;
  }
  else if(tab==='expenses'){
    title.innerText='×”×•×¦××” ×—×“×©×”';
    body.innerHTML=`
      <input id="m-supplier" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="×©× ×”×¡×¤×§">
      <input id="m-amount" type="number" class="w-full p-3 border-2 rounded-lg" placeholder="×¡×›×•×">
    `;
  }
}

function submitModal(){
  if(tab==='tasks'){
    const task=document.getElementById('m-task').value;
    const manager=document.getElementById('m-manager').value;
    const urgency=document.getElementById('m-urgency').value;
    const timeframe=document.getElementById('m-timeframe').value;
    if(!task||!manager)return alert('× × ×œ××œ× ×”×›×œ');
    store.tasks.push({id:uid(),××©×™××”:task,×× ×”×œ:manager,×“×—×™×¤×•×ª:urgency,×˜×•×•×—:timeframe});
  }
  else if(tab==='ideas'){
    const title=document.getElementById('m-title').value;
    const desc=document.getElementById('m-desc').value;
    const proposer=document.getElementById('m-proposer').value;
    const category=document.getElementById('m-category').value;
    if(!title||!desc||!proposer)return alert('× × ×œ××œ× ×”×›×œ');
    store.ideas.unshift({id:uid(),×›×•×ª×¨×ª:title,×ª×™××•×¨:desc,××¦×™×¢:proposer,×ª××¨×™×š:today(),×¡×˜×˜×•×¡:'×—×“×©',×”×¦×‘×¢×•×ª:0,×§×˜×’×•×¨×™×”:category});
  }
  else if(tab==='staff'){
    const name=document.getElementById('m-name').value;
    const role=document.getElementById('m-role').value;
    const phone=document.getElementById('m-phone').value;
    const email=document.getElementById('m-email').value;
    if(!name||!role)return alert('× × ×œ××œ× ×©× ×•×ª×¤×§×™×“');
    store.staff.push({×©×:name,×ª×¤×§×™×“:role,×˜×œ×¤×•×Ÿ:phone,××™××™×™×œ:email});
  }
  else if(tab==='books'){
    const name=document.getElementById('m-name').value;
    const lang=document.getElementById('m-lang').value;
    const target=parseInt(document.getElementById('m-target').value||0);
    const raised=parseInt(document.getElementById('m-raised').value||0);
    if(!name)return alert('× × ×œ×”×–×™×Ÿ ×©×');
    store.books.push({id:uid(),name,lang,target,raised,progress:Math.round(raised/Math.max(1,target)*100)});
  }
  else if(tab==='donors'){
    const name=document.getElementById('m-name').value;
    const project=document.getElementById('m-project').value;
    const amount=document.getElementById('m-amount').value;
    const date=document.getElementById('m-date').value;
    if(!name||!project||!amount)return alert('× × ×œ××œ× ×”×›×œ');
    store.donors.push({×©×:name,×¤×¨×•×™×§×˜:project,××ª× ×”:amount,×ª××¨×™×š:date});
  }
  else if(tab==='expenses'){
    const supplier=document.getElementById('m-supplier').value;
    const amount=document.getElementById('m-amount').value;
    if(!supplier||!amount)return alert('× × ×œ××œ× ×”×›×œ');
    store.expenses.push({×¡×¤×§:supplier,×¡×›×•×:amount});
  }
  save();
  hideModal();
  render();
  notify('× ×©××¨ ×‘×”×¦×œ×—×”!');
}

function showEditModal(){
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal-submit').style.display='none';
  const title=document.getElementById('modal-title');
  const body=document.getElementById('modal-body');
  title.innerText='×¢×¨×™×›×ª × ×ª×•× ×™×';
  body.innerHTML=`
    <div class="space-y-3">
      <button onclick="editAllStaff()" class="w-full p-4 bg-blue-50 hover:bg-blue-100 rounded-lg text-right font-bold text-blue-700">
        <i class="fas fa-users ml-2"></i> ×¢×¨×™×›×ª ×¦×•×•×ª
      </button>
      <button onclick="editAllBooks()" class="w-full p-4 bg-emerald-50 hover:bg-emerald-100 rounded-lg text-right font-bold text-emerald-700">
        <i class="fas fa-book ml-2"></i> ×¢×¨×™×›×ª ×¡×¤×¨×™×
      </button>
      <button onclick="editAllDonors()" class="w-full p-4 bg-purple-50 hover:bg-purple-100 rounded-lg text-right font-bold text-purple-700">
        <i class="fas fa-heart ml-2"></i> ×¢×¨×™×›×ª ×ª×•×¨××™×
      </button>
      <button onclick="editAllExpenses()" class="w-full p-4 bg-red-50 hover:bg-red-100 rounded-lg text-right font-bold text-red-700">
        <i class="fas fa-file-invoice ml-2"></i> ×¢×¨×™×›×ª ×”×•×¦××•×ª
      </button>
    </div>
  `;
}

function editTask(i){
  const t=store.tasks[i];
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal-title').innerText=`××©×™××”: ${t.××©×™××”}`;
  document.getElementById('modal-body').innerHTML=`
    <div class="p-4 bg-slate-50 rounded-lg mb-3">
      <div class="text-xs text-slate-500 mb-1">××—×¨××™</div>
      <div class="font-bold">${esc(t.×× ×”×œ)}</div>
    </div>
    <div class="p-4 bg-slate-50 rounded-lg mb-3">
      <div class="text-xs text-slate-500 mb-1">×“×—×™×¤×•×ª</div>
      <div class="font-bold">${esc(t.×“×—×™×¤×•×ª)}</div>
    </div>
    <button onclick="deleteTask(${i})" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-bold mt-3">
      <i class="fas fa-trash ml-2"></i> ××—×§ ××©×™××”
    </button>
  `;
  document.getElementById('modal-submit').style.display='none';
}

function deleteTask(i){
  if(confirm('×œ××—×•×§?')){
    store.tasks.splice(i,1);
    save();
    hideModal();
    render();
    notify('× ××—×§!');
  }
}

function editIdea(i){
  const idea=store.ideas[i];
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal-title').innerText=`×¨×¢×™×•×Ÿ: ${idea.×›×•×ª×¨×ª}`;
  document.getElementById('modal-body').innerHTML=`
    <input id="e-title" value="${esc(idea.×›×•×ª×¨×ª)}" class="w-full p-3 border-2 rounded-lg mb-3">
    <textarea id="e-desc" class="w-full p-3 border-2 rounded-lg mb-3" rows="4">${esc(idea.×ª×™××•×¨)}</textarea>
    <select id="e-status" class="w-full p-3 border-2 rounded-lg mb-3">
      <option value="×—×“×©" ${idea.×¡×˜×˜×•×¡==='×—×“×©'?'selected':''}>×—×“×©</option>
      <option value="×‘×‘×“×™×§×”" ${idea.×¡×˜×˜×•×¡==='×‘×‘×“×™×§×”'?'selected':''}>×‘×‘×“×™×§×”</option>
      <option value="××•×©×¨" ${idea.×¡×˜×˜×•×¡==='××•×©×¨'?'selected':''}>××•×©×¨</option>
      <option value="× ×“×—×”" ${idea.×¡×˜×˜×•×¡==='× ×“×—×”'?'selected':''}>× ×“×—×”</option>
    </select>
    <button onclick="deleteIdea(${i})" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-bold">
      <i class="fas fa-trash ml-2"></i> ××—×§ ×¨×¢×™×•×Ÿ
    </button>
  `;
  document.getElementById('modal-submit').onclick=()=>{
    store.ideas[i].×›×•×ª×¨×ª=document.getElementById('e-title').value;
    store.ideas[i].×ª×™××•×¨=document.getElementById('e-desc').value;
    store.ideas[i].×¡×˜×˜×•×¡=document.getElementById('e-status').value;
    save();
    hideModal();
    render();
    notify('×¢×•×“×›×Ÿ!');
  };
}

function deleteIdea(i){
  if(confirm('×œ××—×•×§?')){
    store.ideas.splice(i,1);
    save();
    hideModal();
    render();
    notify('× ××—×§!');
  }
}

function editStaff(i){
  const s=store.staff[i];
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal-title').innerText=`×¢×•×‘×“: ${s.×©×}`;
  document.getElementById('modal-body').innerHTML=`
    <div class="space-y-3">
      <div class="p-4 bg-slate-50 rounded-lg">
        <div class="text-xs text-slate-500 mb-1">×©×</div>
        <div class="font-bold">${esc(s.×©×)}</div>
      </div>
      <div class="p-4 bg-slate-50 rounded-lg">
        <div class="text-xs text-slate-500 mb-1">×ª×¤×§×™×“</div>
        <div class="font-bold">${esc(s.×ª×¤×§×™×“)}</div>
      </div>
      <div class="p-4 bg-slate-50 rounded-lg">
        <div class="text-xs text-slate-500 mb-1">×˜×œ×¤×•×Ÿ</div>
        <div class="font-bold">${esc(s.×˜×œ×¤×•×Ÿ)}</div>
      </div>
      <div class="p-4 bg-slate-50 rounded-lg">
        <div class="text-xs text-slate-500 mb-1">××™××™×™×œ</div>
        <div class="font-bold">${esc(s.××™××™×™×œ)}</div>
      </div>
    </div>
  `;
  document.getElementById('modal-submit').style.display='none';
}

function editBook(i){
  const b=store.books[i];
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal-title').innerText=`×¡×¤×¨: ${b.name}`;
  document.getElementById('modal-body').innerHTML=`
    <div class="mb-4">
      <div class="w-full bg-slate-100 h-4 rounded-full mb-2">
        <div class="bg-emerald-500 h-full rounded-full" style="width:${b.progress}%"></div>
      </div>
      <div class="flex justify-between text-sm">
        <span class="font-bold text-emerald-600">${money(b.raised)}</span>
        <span class="text-slate-400">×™×¢×“: ${money(b.target)}</span>
      </div>
    </div>
    <input id="e-raised" type="number" value="${b.raised}" class="w-full p-3 border-2 rounded-lg mb-3" placeholder="× ×’×‘×”">
    <input id="e-target" type="number" value="${b.target}" class="w-full p-3 border-2 rounded-lg" placeholder="×™×¢×“">
  `;
  document.getElementById('modal-submit').onclick=()=>{
    const raised=parseInt(document.getElementById('e-raised').value||0);
    const target=parseInt(document.getElementById('e-target').value||0);
    store.books[i].raised=raised;
    store.books[i].target=target;
    store.books[i].progress=Math.round(raised/Math.max(1,target)*100);
    save();
    hideModal();
    render();
    notify('×¢×•×“×›×Ÿ!');
  };
}

function editDonor(i){
  const d=store.donors[i];
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal-title').innerText=`×ª×•×¨×: ${d.×©×}`;
  document.getElementById('modal-body').innerHTML=`
    <div class="grid grid-cols-2 gap-3">
      <div class="p-4 bg-slate-50 rounded-lg">
        <div class="text-xs text-slate-500 mb-1">×¤×¨×•×™×§×˜</div>
        <div class="font-bold">${esc(d.×¤×¨×•×™×§×˜)}</div>
      </div>
      <div class="p-4 bg-slate-50 rounded-lg">
        <div class="text-xs text-slate-500 mb-1">×ª××¨×™×š</div>
        <div class="font-bold">${d.×ª××¨×™×š}</div>
      </div>
      <div class="p-4 bg-emerald-50 rounded-lg col-span-2">
        <div class="text-xs text-emerald-600 mb-1">×¡×›×•×</div>
        <div class="font-bold text-emerald-700">${money(parseInt(d.××ª× ×”||0))}</div>
      </div>
    </div>
    <button onclick="deleteDonor(${i})" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-bold mt-4">
      <i class="fas fa-trash ml-2"></i> ××—×§ ×ª×¨×•××”
    </button>
  `;
  document.getElementById('modal-submit').style.display='none';
}

function deleteDonor(i){
  if(confirm('×œ××—×•×§?')){
    store.donors.splice(i,1);
    save();
    hideModal();
    render();
    notify('× ××—×§!');
  }
}

function editAllStaff(){hideModal();alert('×¤×ª×— ×¢×¨×™×›×” ××œ××” ×‘×’×¨×¡×” ×”×‘××”')}
function editAllBooks(){hideModal();alert('×¤×ª×— ×¢×¨×™×›×” ××œ××” ×‘×’×¨×¡×” ×”×‘××”')}
function editAllDonors(){hideModal();alert('×¤×ª×— ×¢×¨×™×›×” ××œ××” ×‘×’×¨×¡×” ×”×‘××”')}
function editAllExpenses(){hideModal();alert('×¤×ª×— ×¢×¨×™×›×” ××œ××” ×‘×’×¨×¡×” ×”×‘××”')}

function hideModal(){
  document.getElementById('modal').classList.add('hidden');
  document.getElementById('modal-submit').style.display='inline-block';
  document.getElementById('modal-submit').onclick=submitModal;
}

function notify(msg){
  const n=document.createElement('div');
  n.className='fixed top-10 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-8 py-3 rounded-lg shadow-2xl z-50 font-bold';
  n.innerHTML=`<i class="fas fa-check-circle ml-2"></i> ${msg}`;
  document.body.appendChild(n);
  setTimeout(()=>{n.style.opacity='0';n.style.transition='opacity .3s';setTimeout(()=>n.remove(),300)},2500);
}

load();
updateBadge();
switchTab('tasks');
  </script>
</body>
</html>
